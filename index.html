<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мессенджер с авторизацией</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#007aff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: #0a0a0a;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 255, 198, 0.2) 0%, transparent 50%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            color: #ffffff;
            overflow: hidden;
            position: relative;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23333" stroke-width="0.5" opacity="0.3"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            pointer-events: none;
            z-index: -1;
        }
        
        .container {
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid #333;
            border-radius: 0;
            box-shadow: 
                0 0 50px rgba(120, 119, 198, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: relative;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #7877c6, #ff77c6, #77ffc6);
            animation: neonPulse 2s ease-in-out infinite alternate;
        }
        
        @keyframes neonPulse {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            border-radius: 32px;
            animation: shimmer 3s linear infinite;
            pointer-events: none;
        }
        
        @keyframes glow {
            0% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1) inset, 0 0 100px rgba(255, 255, 255, 0.1); }
            100% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.2) inset, 0 0 150px rgba(255, 255, 255, 0.2); }
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(200%) rotate(45deg); }
        }
        
        .chat-app {
            display: flex;
            width: 100vw;
            height: 100vh;
            background: transparent;
            overflow: hidden;
            position: relative;
        }
        
        .sidebar {
            width: 320px;
            min-width: 60px;
            max-width: 500px;
            background: rgba(10, 10, 10, 0.9);
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            transition: width 0.3s ease;
            resize: horizontal;
        }
        
        .sidebar.collapsed {
            width: 60px;
        }
        
        .sidebar-resizer {
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: transparent;
            cursor: col-resize;
            z-index: 1000;
            transition: background 0.2s ease;
        }
        
        .sidebar-resizer:hover {
            background: rgba(120, 119, 198, 0.5);
        }
        
        .sidebar-toggle {
            position: absolute;
            top: 50%;
            right: -12px;
            width: 24px;
            height: 24px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #333;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7877c6;
            font-size: 12px;
            z-index: 1001;
            transition: all 0.2s ease;
            transform: translateY(-50%);
        }
        
        .sidebar-toggle:hover {
            background: rgba(120, 119, 198, 0.2);
            transform: translateY(-50%) scale(1.1);
        }
        
        .sidebar::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, #7877c6, #ff77c6, #77ffc6);
            animation: neonPulse 3s ease-in-out infinite alternate;
        }
        
        @media (max-width: 768px) {
            .chat-app {
                overflow-x: hidden;
            }
            
            .sidebar {
                position: fixed;
                transform: translateX(-100%);
                top: 0;
                height: 100vh;
                width: 80vw;
                max-width: 320px;
                z-index: 1000;
                background: rgba(28, 28, 30, 0.98);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .user-info {
                padding-left: 70px;
            }
        }
        
        @media (max-width: 768px) {
            .chat-app {
                overflow-x: hidden;
            }
            
            .sidebar {
                position: fixed;
                transform: translateX(-100%);
                top: 0;
                height: 100vh;
                width: 80vw;
                max-width: 320px;
                z-index: 1000;
                background: rgba(28, 28, 30, 0.98);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .user-info {
                padding-left: 70px;
            }
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #333;
            background: rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .sidebar-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20px;
            right: 20px;
            height: 1px;
            background: linear-gradient(90deg, transparent, #7877c6, transparent);
        }
        
        .sidebar-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            transition: opacity 0.3s ease;
        }
        
        .sidebar.collapsed .sidebar-title {
            opacity: 0;
        }
        
        .sidebar.collapsed .logout-btn {
            opacity: 0;
            pointer-events: none;
        }
        
        .sidebar.collapsed .chat-name,
        .sidebar.collapsed .chat-preview,
        .sidebar.collapsed .users-header {
            opacity: 0;
        }
        
        .sidebar.collapsed .chat-item {
            justify-content: center;
        }
        
        .sidebar.collapsed .chat-info {
            display: none;
        }
        
        .sidebar-title::before {
            content: '▶';
            color: #7877c6;
            margin-right: 10px;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .chat-list {
            overflow-y: auto;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chat-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid #222;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            background: transparent;
        }
        
        .chat-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0;
            background: linear-gradient(90deg, #7877c6, #ff77c6);
            transition: width 0.3s ease;
        }
        
        .chat-item:hover {
            background: rgba(120, 119, 198, 0.1);
            transform: translateX(5px);
        }
        
        .chat-item:hover::before {
            width: 3px;
        }
        
        .chat-item.active {
            background: rgba(120, 119, 198, 0.2);
            border-left: 3px solid #7877c6;
        }
        
        .chat-item.active::before {
            width: 3px;
        }
        
        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            background: #333;
            border: 1px solid #555;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            color: #7877c6;
            flex-shrink: 0;
            position: relative;
        }
        
        .chat-avatar::after {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(45deg, #7877c6, #ff77c6, #77ffc6, #7877c6);
            border-radius: 4px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .chat-item:hover .chat-avatar::after {
            opacity: 1;
        }
        
        .chat-info {
            flex: 1;
            min-width: 0;
        }
        
        .chat-name {
            font-size: 16px;
            font-weight: 500;
            color: #ffffff;
            margin: 0 0 4px 0;
        }
        
        .chat-preview {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(5, 5, 5, 0.8);
            position: relative;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header {
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid #333;
            color: #ffffff;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #7877c6, transparent);
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 1px;
            color: #fff;
            margin: 0;
            text-transform: uppercase;
            position: relative;
        }
        
        .header h1::before {
            content: '◉';
            color: #7877c6;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .call-interface {
            text-align: center;
            color: white;
        }
        
        .call-avatar {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
        }
        
        .avatar-ring {
            position: absolute;
            width: 120px;
            height: 120px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .avatar-inner {
            width: 100px;
            height: 100px;
            background: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            margin: 10px;
            border: 2px solid #555;
        }
        
        .call-info {
            margin-bottom: 50px;
        }
        
        .caller-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .call-status {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            font-family: 'Courier New', monospace;
        }
        
        .call-controls {
            display: flex;
            justify-content: center;
            gap: 60px;
        }
        
        .call-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .call-btn.accept {
            background: #34c759;
            color: white;
        }
        
        .call-btn.decline {
            background: #ff3b30;
            color: white;
        }
        
        .call-btn.end {
            background: #ff3b30;
            color: white;
        }
        
        .call-btn:hover {
            transform: scale(1.1);
        }
        
        .call-btn.camera {
            background: #007aff;
            color: white;
        }
        
        .call-btn.camera {
            background: #007aff;
            color: white;
        }
        
        .call-btn.screen {
            background: #ff9500;
            color: white;
        }
        
        .video-container {
            position: relative;
            margin-bottom: 20px;
            width: 100%;
            max-width: 600px;
            height: 400px;
            background: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #localVideo {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 150px;
            height: 100px;
            border-radius: 8px;
            border: 2px solid #007aff;
            z-index: 2;
            background: #333;
        }
        
#remoteVideo, #localVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }
        
        #localVideo {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 150px;
            height: 100px;
            border: 2px solid #007aff;
            z-index: 2;
        }
        
        #remoteVideo {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* Light Theme */
        body.light-theme {
            background: #ffffff;
            color: #1d1d1f;
        }
        
        body.light-theme::before {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23f0f0f0" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        }
        
        body.light-theme .container {
            background: #ffffff;
            border: 1px solid #e5e5e7;
        }
        
        body.light-theme .container::before {
            background: linear-gradient(90deg, #007aff, #34c759);
        }
        
        body.light-theme .chat-app {
            background: #ffffff;
        }
        
        body.light-theme .sidebar {
            background: #f2f2f7;
            border-right: 1px solid #e5e5e7;
        }
        
        body.light-theme .sidebar-toggle {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #d1d1d6;
            color: #007aff;
        }
        
        body.light-theme .sidebar-resizer:hover {
            background: rgba(0, 122, 255, 0.5);
        }
        
        body.light-theme .sidebar::after {
            background: linear-gradient(180deg, #007aff, #34c759);
        }
        
        body.light-theme .sidebar-header {
            background: #ffffff;
            border-bottom: 1px solid #e5e5e7;
        }
        
        body.light-theme .sidebar-title {
            color: #1d1d1f;
        }
        
        body.light-theme .sidebar-title::before {
            color: #007aff;
        }
        
        body.light-theme .chat-item {
            color: #1d1d1f;
            border-bottom: 1px solid #f0f0f0;
        }
        
        body.light-theme .chat-name {
            color: #1d1d1f;
        }
        
        body.light-theme .chat-preview {
            color: #8e8e93;
        }
        
        body.light-theme .chat-item:hover {
            background: rgba(0, 122, 255, 0.1);
        }
        
        body.light-theme .chat-item.active {
            background: rgba(0, 122, 255, 0.1);
            border-left: 3px solid #007aff;
        }
        
        body.light-theme .chat-avatar {
            background: #e5e5e7;
            border: 1px solid #d1d1d6;
            color: #007aff;
        }
        
        body.light-theme .main-chat {
            background: #ffffff;
        }
        
        body.light-theme .header {
            background: #f2f2f7;
            border-bottom: 1px solid #e5e5e7;
        }
        
        body.light-theme .header h1 {
            color: #1d1d1f;
        }
        
        body.light-theme .header h1::before {
            color: #007aff;
        }
        
        body.light-theme .user-info {
            background: #f2f2f7;
            border-bottom: 1px solid #e5e5e7;
            color: #1d1d1f;
        }
        
        body.light-theme #currentUser {
            color: #8e8e93;
        }
        
        body.light-theme #starsCounter {
            color: #ff9500;
        }
        
        body.light-theme input[type="text"], body.light-theme input[type="password"] {
            background: #ffffff;
            border: 1px solid #d1d1d6;
            color: #1d1d1f;
        }
        
        body.light-theme input::placeholder {
            color: #8e8e93;
        }
        
        body.light-theme .btn-primary {
            background: #007aff;
            color: #ffffff;
            border: 1px solid #007aff;
        }
        
        body.light-theme .btn-secondary {
            background: #ff3b30;
            color: #ffffff;
            border: 1px solid #ff3b30;
        }
        
        body.light-theme .message {
            background: #f2f2f7;
            border: 1px solid #e5e5e7;
            border-left: 3px solid #d1d1d6;
            color: #1d1d1f;
        }
        
        body.light-theme .message.own {
            background: #007aff;
            border-left: 3px solid #0051d5;
            color: #ffffff;
        }
        
        body.light-theme .message strong {
            color: #007aff;
        }
        
        body.light-theme .message.own strong {
            color: rgba(255, 255, 255, 0.9);
        }
        
        body.light-theme .message small {
            color: #8e8e93;
        }
        
        body.light-theme .message.own small {
            color: rgba(255, 255, 255, 0.7);
        }
        
        body.light-theme #messages {
            background: #ffffff;
        }
        
        body.light-theme .input-area {
            background: #f2f2f7;
            border-top: 1px solid #e5e5e7;
        }
        
        body.light-theme #messageInput {
            background: #ffffff;
            border: 1px solid #d1d1d6;
            color: #1d1d1f;
        }
        
        body.light-theme .send-btn {
            background: #007aff;
            color: #ffffff;
            border: 1px solid #007aff;
        }
        
        body.light-theme .gift-btn {
            background: #ff9500;
            color: #ffffff;
            border: 1px solid #ff9500;
        }
        
        body.light-theme .users-section {
            border-top: 1px solid #e5e5e7;
        }
        
        body.light-theme .users-header {
            color: #8e8e93;
        }
        
        body.light-theme .user-name {
            color: #1d1d1f;
        }
        
        body.light-theme .user-name.offline {
            color: #8e8e93;
        }
        
        body.light-theme .logout-btn {
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid #d1d1d6;
            color: #1d1d1f;
        }
        
        body.light-theme .admin-panel {
            background: #f2f2f7;
            border-top: 1px solid #e5e5e7;
        }
        
        body.light-theme .admin-toggle {
            background: #ffffff;
            border: 1px solid #ff3b30;
            color: #ff3b30;
        }
        
        body.light-theme .disco-btn {
            background: #ffffff;
            border: 1px solid #007aff;
            color: #007aff;
        }
        
        body.light-theme .hammer-btn {
            background: #ffffff;
            border: 1px solid #34c759;
            color: #34c759;
        }
        
        /* Purple Theme */
        body.purple-theme {
            background: #1a0d2e;
            color: #e0c3fc;
        }
        
        body.purple-theme::before {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23663399" stroke-width="0.5" opacity="0.3"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        }
        
        body.purple-theme .container {
            background: rgba(26, 13, 46, 0.95);
            border: 1px solid #663399;
        }
        
        body.purple-theme .container::before {
            background: linear-gradient(90deg, #9d4edd, #c77dff, #e0aaff);
        }
        
        body.purple-theme .sidebar {
            background: rgba(16, 8, 32, 0.9);
            border-right: 1px solid #663399;
        }
        
        body.purple-theme .sidebar-toggle {
            background: rgba(26, 13, 46, 0.9);
            border: 1px solid #663399;
            color: #c77dff;
        }
        
        body.purple-theme .sidebar-resizer:hover {
            background: rgba(199, 125, 255, 0.5);
        }
        
        body.purple-theme .sidebar::after {
            background: linear-gradient(180deg, #9d4edd, #c77dff, #e0aaff);
        }
        
        body.purple-theme .sidebar-title::before {
            color: #c77dff;
        }
        
        body.purple-theme .chat-item::before {
            background: linear-gradient(90deg, #9d4edd, #c77dff);
        }
        
        body.purple-theme .chat-item:hover {
            background: rgba(157, 78, 221, 0.1);
        }
        
        body.purple-theme .chat-item.active {
            background: rgba(157, 78, 221, 0.2);
            border-left: 3px solid #c77dff;
        }
        
        body.purple-theme .chat-avatar {
            background: #2d1b4e;
            border: 1px solid #663399;
            color: #c77dff;
        }
        
        body.purple-theme .main-chat {
            background: rgba(10, 5, 20, 0.8);
        }
        
        body.purple-theme .header::after {
            background: linear-gradient(90deg, transparent, #c77dff, transparent);
        }
        
        body.purple-theme .header h1::before {
            color: #c77dff;
        }
        
        body.purple-theme input[type="text"]:focus, body.purple-theme input[type="password"]:focus {
            border-color: #c77dff;
            box-shadow: 0 0 10px rgba(199, 125, 255, 0.3);
        }
        
        body.purple-theme .btn-primary {
            background: rgba(0, 0, 0, 0.9);
            color: #c77dff;
            border: 1px solid #c77dff;
        }
        
        body.purple-theme .btn-secondary {
            background: rgba(0, 0, 0, 0.9);
            color: #e0aaff;
            border: 1px solid #e0aaff;
        }
        
        body.purple-theme .message.own {
            border-left: 3px solid #c77dff;
        }
        
        body.purple-theme #messageInput:focus {
            border-color: #c77dff;
            box-shadow: 0 0 10px rgba(199, 125, 255, 0.3);
        }
        
        body.purple-theme .send-btn {
            background: rgba(0, 0, 0, 0.9);
            color: #c77dff;
            border: 1px solid #c77dff;
        }
        
        body.purple-theme .send-btn:hover {
            background: rgba(199, 125, 255, 0.1);
            box-shadow: 0 0 15px rgba(199, 125, 255, 0.4);
        }
        
        body.purple-theme .gift-btn {
            background: rgba(0, 0, 0, 0.9);
            color: #e0aaff;
            border: 1px solid #e0aaff;
        }
        
        body.purple-theme .gift-btn:hover {
            background: rgba(224, 170, 255, 0.1);
            box-shadow: 0 0 15px rgba(224, 170, 255, 0.4);
        }
        
        body.purple-theme .admin-toggle {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #e0aaff;
            color: #e0aaff;
        }
        
        body.purple-theme .disco-btn {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #c77dff;
            color: #c77dff;
        }
        
        body.purple-theme .hammer-btn {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #9d4edd;
            color: #9d4edd;
        }
        
        /* Green Theme */
        body.green-theme {
            background: #0d2818;
            color: #a7f3d0;
        }
        
        body.green-theme::before {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23059669" stroke-width="0.5" opacity="0.3"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        }
        
        body.green-theme .container {
            background: rgba(13, 40, 24, 0.95);
            border: 1px solid #059669;
        }
        
        body.green-theme .container::before {
            background: linear-gradient(90deg, #10b981, #34d399, #6ee7b7);
        }
        
        body.green-theme .sidebar {
            background: rgba(6, 20, 12, 0.9);
            border-right: 1px solid #059669;
        }
        
        body.green-theme .sidebar-toggle {
            background: rgba(13, 40, 24, 0.9);
            border: 1px solid #059669;
            color: #34d399;
        }
        
        body.green-theme .sidebar-resizer:hover {
            background: rgba(52, 211, 153, 0.5);
        }
        
        body.green-theme .sidebar::after {
            background: linear-gradient(180deg, #10b981, #34d399, #6ee7b7);
        }
        
        body.green-theme .sidebar-title::before {
            color: #34d399;
        }
        
        body.green-theme .chat-item::before {
            background: linear-gradient(90deg, #10b981, #34d399);
        }
        
        body.green-theme .chat-item:hover {
            background: rgba(16, 185, 129, 0.1);
        }
        
        body.green-theme .chat-item.active {
            background: rgba(16, 185, 129, 0.2);
            border-left: 3px solid #34d399;
        }
        
        body.green-theme .chat-avatar {
            background: #1e4d32;
            border: 1px solid #059669;
            color: #34d399;
        }
        
        body.green-theme .main-chat {
            background: rgba(3, 15, 8, 0.8);
        }
        
        body.green-theme .header::after {
            background: linear-gradient(90deg, transparent, #34d399, transparent);
        }
        
        body.green-theme .header h1::before {
            color: #34d399;
        }
        
        body.green-theme input[type="text"]:focus, body.green-theme input[type="password"]:focus {
            border-color: #34d399;
            box-shadow: 0 0 10px rgba(52, 211, 153, 0.3);
        }
        
        body.green-theme .btn-primary {
            background: rgba(0, 0, 0, 0.9);
            color: #34d399;
            border: 1px solid #34d399;
        }
        
        body.green-theme .btn-secondary {
            background: rgba(0, 0, 0, 0.9);
            color: #6ee7b7;
            border: 1px solid #6ee7b7;
        }
        
        body.green-theme .message.own {
            border-left: 3px solid #34d399;
        }
        
        body.green-theme #messageInput:focus {
            border-color: #34d399;
            box-shadow: 0 0 10px rgba(52, 211, 153, 0.3);
        }
        
        body.green-theme .send-btn {
            background: rgba(0, 0, 0, 0.9);
            color: #34d399;
            border: 1px solid #34d399;
        }
        
        body.green-theme .send-btn:hover {
            background: rgba(52, 211, 153, 0.1);
            box-shadow: 0 0 15px rgba(52, 211, 153, 0.4);
        }
        
        body.green-theme .gift-btn {
            background: rgba(0, 0, 0, 0.9);
            color: #6ee7b7;
            border: 1px solid #6ee7b7;
        }
        
        body.green-theme .gift-btn:hover {
            background: rgba(110, 231, 183, 0.1);
            box-shadow: 0 0 15px rgba(110, 231, 183, 0.4);
        }
        
        body.green-theme .admin-toggle {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #6ee7b7;
            color: #6ee7b7;
        }
        
        body.green-theme .disco-btn {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #34d399;
            color: #34d399;
        }
        
        body.green-theme .hammer-btn {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #10b981;
            color: #10b981;
        }
        
        /* Retro Terminal Theme */
        body.retro-theme {
            background: #000000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
        }
        
        body.retro-theme::before {
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 255, 0, 0.03) 2px,
                rgba(0, 255, 0, 0.03) 4px
            );
        }
        
        body.retro-theme .container {
            background: rgba(0, 0, 0, 0.98);
            border: 2px solid #00ff00;
            box-shadow: 0 0 20px #00ff00;
        }
        
        body.retro-theme .container::before {
            background: linear-gradient(90deg, #00ff00, #00aa00);
        }
        
        body.retro-theme .sidebar {
            background: rgba(0, 20, 0, 0.9);
            border-right: 1px solid #00ff00;
        }
        
        body.retro-theme .sidebar-toggle {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00ff00;
            color: #00ff00;
        }
        
        body.retro-theme .sidebar-resizer:hover {
            background: rgba(0, 255, 0, 0.5);
        }
        
        body.retro-theme .sidebar-title::before {
            color: #00ff00;
        }
        
        body.retro-theme .chat-item:hover {
            background: rgba(0, 255, 0, 0.1);
        }
        
        body.retro-theme .chat-item.active {
            background: rgba(0, 255, 0, 0.2);
            border-left: 3px solid #00ff00;
        }
        
        body.retro-theme .main-chat {
            background: rgba(0, 10, 0, 0.8);
        }
        
        body.retro-theme input, body.retro-theme button {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00ff00;
            color: #00ff00;
        }
        
        body.retro-theme .message {
            background: rgba(0, 20, 0, 0.8);
            border-left: 3px solid #00aa00;
            color: #00ff00;
        }
        
        body.retro-theme .message.own {
            border-left: 3px solid #00ff00;
        }
        
        /* Glass Theme - Improved Version */
        body.glass-theme {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }
        
        body.glass-theme::before {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="%23ffffff" stroke-width="0.3" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        }
        
        body.glass-theme .container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            border-radius: 16px;
            overflow: hidden;
        }
        
        body.glass-theme .container::before {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
            animation: shimmer 3s linear infinite;
        }
        
        body.glass-theme .chat-app {
            background: transparent;
        }
        
        body.glass-theme .sidebar {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
        }
        
        body.glass-theme .sidebar-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
        }
        
        body.glass-theme .sidebar-resizer:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        body.glass-theme .sidebar::after {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.4));
            animation: neonPulse 3s ease-in-out infinite alternate;
        }
        
        body.glass-theme .sidebar-header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.glass-theme .sidebar-title {
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .sidebar-title::before {
            color: rgba(255, 255, 255, 0.9);
        }
        
        body.glass-theme .chat-list {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.glass-theme .chat-item {
            color: #ffffff;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            background: transparent;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .chat-item::before {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.2));
        }
        
        body.glass-theme .chat-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        body.glass-theme .chat-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 3px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        body.glass-theme .chat-name {
            color: #ffffff;
            font-weight: 600;
        }
        
        body.glass-theme .chat-preview {
            color: rgba(255, 255, 255, 0.7);
        }
        
        body.glass-theme .chat-avatar {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        body.glass-theme .chat-avatar::after {
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.4));
        }
        
        body.glass-theme .main-chat {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }
        
        body.glass-theme .header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.glass-theme .header::after {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        }
        
        body.glass-theme .header h1 {
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .header h1::before {
            color: rgba(255, 255, 255, 0.9);
        }
        
        body.glass-theme .user-info {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }
        
        body.glass-theme #currentUser {
            color: rgba(255, 255, 255, 0.8);
        }
        
        body.glass-theme #starsCounter {
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        body.glass-theme input[type="text"], 
        body.glass-theme input[type="password"] {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        body.glass-theme input[type="text"]:focus, 
        body.glass-theme input[type="password"]:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.1);
        }
        
        body.glass-theme input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        body.glass-theme .btn-primary {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #ffffff;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .btn-secondary {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .btn-primary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .message {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-left: 3px solid rgba(255, 255, 255, 0.4);
            color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        body.glass-theme .message.own {
            background: rgba(255, 255, 255, 0.25);
            border-left: 3px solid rgba(255, 255, 255, 0.8);
        }
        
        body.glass-theme .message strong {
            color: rgba(255, 255, 255, 0.95);
        }
        
        body.glass-theme .message small {
            color: rgba(255, 255, 255, 0.7);
        }
        
        body.glass-theme #messages {
            background: rgba(255, 255, 255, 0.05);
        }
        
        body.glass-theme .input-area {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.glass-theme #messageInput {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            border-radius: 12px;
        }
        
        body.glass-theme #messageInput:focus {
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.1);
        }
        
        body.glass-theme .send-btn {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .send-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .gift-btn {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .gift-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .users-section {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.glass-theme .users-header {
            color: rgba(255, 255, 255, 0.8);
        }
        
        body.glass-theme .user-name {
            color: #ffffff;
        }
        
        body.glass-theme .user-name.offline {
            color: rgba(255, 255, 255, 0.6);
        }
        
        body.glass-theme .logout-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .logout-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .admin-panel {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.glass-theme .admin-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #ffffff;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .admin-toggle.active {
            background: rgba(255, 255, 255, 0.3);
            color: #ffffff;
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }
        
        body.glass-theme .admin-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .disco-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #ffffff;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .disco-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .hammer-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #ffffff;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .hammer-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .gift-panel {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3);
            border-radius: 16px;
        }
        
        body.glass-theme .gift-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.glass-theme .gift-header h3 {
            color: #ffffff;
        }
        
        body.glass-theme .close-gift {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .close-gift:hover {
            background: rgba(255, 255, 255, 0.25);
            color: #ffffff;
        }
        
        body.glass-theme .gift-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .gift-item:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .gift-name {
            color: #ffffff;
        }
        
        body.glass-theme .gift-price {
            color: #ffd700;
        }
        
        body.glass-theme .disco-settings {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        body.glass-theme .settings-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.glass-theme .settings-header h3 {
            color: #ffffff;
        }
        
        body.glass-theme .close-settings {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        body.glass-theme .close-settings:hover {
            background: rgba(255, 255, 255, 0.25);
            color: #ffffff;
        }
        
        body.glass-theme .setting-group label {
            color: rgba(255, 255, 255, 0.9);
        }
        
        body.glass-theme .setting-group select {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            border-radius: 12px;
        }
        
        body.glass-theme .system-message {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
        }
        
        body.glass-theme .message.admin {
            background: linear-gradient(135deg, rgba(255, 59, 48, 0.3), rgba(255, 149, 0, 0.3));
            border: 1px solid rgba(255, 59, 48, 0.2);
            border-radius: 12px;
        }
        
        body.glass-theme .message.admin::before {
            background: rgba(255, 59, 48, 0.7);
            border-radius: 12px;
        }
        
        /* Scrollbar styling for glass theme */
        body.glass-theme #messages::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
        
        body.glass-theme #messages::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        /* Call interface styling for glass theme */
        body.glass-theme .call-overlay {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9)) !important;
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
        }
        
        body.glass-theme .call-interface {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        body.glass-theme .call-btn {
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        body.glass-theme .call-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        body.glass-theme .video-container {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            overflow: hidden;
        }
        
        /* Updates overlay for glass theme */
        body.glass-theme #updatesOverlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }
        
        body.glass-theme #updatesOverlay > div {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3);
        }
        
        body.glass-theme #updatesOverlay h3,
        body.glass-theme #updatesOverlay h4 {
            color: #ffffff;
        }
        
        body.glass-theme #updatesOverlay table {
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* Theme menu styles */
        .theme-option:hover {
            background: rgba(120, 119, 198, 0.2) !important;
            transform: translateX(5px);
        }
        
        /* Theme button animations */
        #themeMenuBtn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 119, 198, 0.3), transparent);
            transition: left 0.6s ease;
        }
        
        #themeMenuBtn:hover::before {
            left: 100%;
        }
        
        #themeMenuBtn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 119, 198, 0.4);
        }
        
        #themeMenuBtn:active {
            transform: scale(0.95);
        }
        
        /* Theme transition overlay */
        .theme-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            z-index: 9999;
            pointer-events: none;
            opacity: 0;
            animation: themeTransition 0.8s ease-out;
        }
        
        @keyframes themeTransition {
            0% {
                opacity: 0;
                transform: scale(0);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
            100% {
                opacity: 0;
                transform: scale(2);
            }
        }
        
        body.light-theme .theme-option:hover {
            background: rgba(0, 122, 255, 0.2) !important;
        }
        
        body.purple-theme .theme-option:hover {
            background: rgba(199, 125, 255, 0.2) !important;
        }
        
        body.green-theme .theme-option:hover {
            background: rgba(52, 211, 153, 0.2) !important;
        }
        
        body.retro-theme .theme-option:hover {
            background: rgba(0, 255, 0, 0.2) !important;
        }
        
        body.glass-theme .theme-option:hover {
            background: rgba(255, 255, 255, 0.2) !important;
        }
        
        body.light-theme #themeMenu {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #e5e5e7;
        }
        
        body.light-theme .theme-option {
            color: #1d1d1f !important;
        }
        
        body.purple-theme #themeMenu {
            background: rgba(26, 13, 46, 0.95);
            border: 1px solid #663399;
        }
        
        body.green-theme #themeMenu {
            background: rgba(13, 40, 24, 0.95);
            border: 1px solid #059669;
        }
        
        body.retro-theme #themeMenu {
            background: rgba(0, 20, 0, 0.95);
            border: 1px solid #00ff00;
        }
        
        body.glass-theme #themeMenu {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 12px;
        }
        
        /* Light Theme Panels */
        body.light-theme .gift-panel {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #e5e5e7;
        }
        
        body.light-theme .gift-header {
            border-bottom: 1px solid #e5e5e7;
        }
        
        body.light-theme .gift-header h3 {
            color: #1d1d1f;
        }
        
        body.light-theme .close-gift {
            background: rgba(0, 0, 0, 0.1);
            color: #8e8e93;
        }
        
        body.light-theme .gift-item {
            background: #f2f2f7;
            border: 1px solid #e5e5e7;
        }
        
        body.light-theme .gift-name {
            color: #1d1d1f;
        }
        
        body.light-theme select, body.light-theme input[type="number"] {
            background: #ffffff;
            border: 1px solid #d1d1d6;
            color: #1d1d1f;
        }
        
        /* Purple Theme Panels */
        body.purple-theme .gift-panel {
            background: rgba(26, 13, 46, 0.95);
            border: 1px solid #663399;
        }
        
        body.purple-theme .gift-header h3 {
            color: #e0c3fc;
        }
        
        body.purple-theme .close-gift {
            background: rgba(199, 125, 255, 0.1);
            color: #c77dff;
        }
        
        body.purple-theme .gift-item {
            background: rgba(45, 27, 78, 0.8);
            border: 1px solid #663399;
        }
        
        body.purple-theme .gift-name {
            color: #e0c3fc;
        }
        
        body.purple-theme select, body.purple-theme input[type="number"] {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #663399;
            color: #e0c3fc;
        }
        
        /* Green Theme Panels */
        body.green-theme .gift-panel {
            background: rgba(13, 40, 24, 0.95);
            border: 1px solid #059669;
        }
        
        body.green-theme .gift-header h3 {
            color: #a7f3d0;
        }
        
        body.green-theme .close-gift {
            background: rgba(52, 211, 153, 0.1);
            color: #34d399;
        }
        
        body.green-theme .gift-item {
            background: rgba(30, 77, 50, 0.8);
            border: 1px solid #059669;
        }
        
        body.green-theme .gift-name {
            color: #a7f3d0;
        }
        
        body.green-theme select, body.green-theme input[type="number"] {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #059669;
            color: #a7f3d0;
        }
        
        /* Updates overlay themes */
        body.light-theme #updatesOverlay {
            background: rgba(0, 0, 0, 0.3);
        }
        
        body.light-theme #updatesOverlay .gift-panel {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #e5e5e7;
        }
        
        body.light-theme #updatesOverlay h3, body.light-theme #updatesOverlay h4 {
            color: #1d1d1f;
        }
        
        body.light-theme #updatesOverlay table {
            color: #1d1d1f;
        }
        
        body.purple-theme #updatesOverlay .gift-panel {
            background: rgba(26, 13, 46, 0.95);
            border: 1px solid #663399;
        }
        
        body.purple-theme #updatesOverlay h3, body.purple-theme #updatesOverlay h4 {
            color: #e0c3fc;
        }
        
        body.green-theme #updatesOverlay .gift-panel {
            background: rgba(13, 40, 24, 0.95);
            border: 1px solid #059669;
        }
        
        body.green-theme #updatesOverlay h3, body.green-theme #updatesOverlay h4 {
            color: #a7f3d0;
        }
        
        .auth-form {
            padding: 32px 24px;
            background: rgba(44, 44, 46, 0.6);
        }
        
        .form-group {
            margin-bottom: 24px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            font-size: 15px;
            letter-spacing: -0.2px;
        }
        
        .input-wrapper {
            position: relative;
        }
        
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid #333;
            border-radius: 0;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            transition: all 0.2s ease;
            font-family: 'Courier New', monospace;
        }
        
        input[type="text"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: #7877c6;
            background: rgba(0, 0, 0, 0.9);
            box-shadow: 0 0 10px rgba(120, 119, 198, 0.3);
        }
        
        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 32px;
        }
        
        button {
            width: 100%;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 0;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Courier New', monospace;
        }
        
        .btn-primary {
            background: rgba(0, 0, 0, 0.9);
            color: #7877c6;
            border: 1px solid #7877c6;
        }
        
        .btn-secondary {
            background: rgba(0, 0, 0, 0.9);
            color: #ff77c6;
            border: 1px solid #ff77c6;
        }
        
        button:hover {
            background: rgba(120, 119, 198, 0.1);
            box-shadow: 0 0 20px rgba(120, 119, 198, 0.3);
        }
        
        button:active {
            transform: scale(0.96);
        }
        
        .btn-primary:hover {
            background: rgba(120, 119, 198, 0.2);
            color: #fff;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 119, 198, 0.2);
            color: #fff;
        }
        
        .error-message {
            background: rgba(255, 59, 48, 0.15);
            border: 1px solid rgba(255, 59, 48, 0.3);
            color: #ff3b30;
            padding: 16px 20px;
            border-radius: 12px;
            margin-top: 20px;
            font-size: 15px;
            font-weight: 500;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            animation: shake 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .chat-container {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .user-info {
            background: rgba(0, 122, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info strong {
            font-size: 16px;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(0.95);
        }
        
        #messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        #messages::-webkit-scrollbar {
            width: 4px;
        }
        
        #messages::-webkit-scrollbar-track {
            background: transparent;
        }
        
        #messages::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }
        
        #messages::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .message {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #333;
            border-left: 3px solid #555;
            margin-bottom: 10px;
            padding: 12px 16px;
            border-radius: 0;
            position: relative;
            max-width: 80%;
            color: #fff;
            margin-left: 0;
            margin-right: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .message.own {
            background: rgba(0, 0, 0, 0.8);
            border-left: 3px solid #7877c6;
            margin-left: auto;
            margin-right: 0;
        }
        
        .message.own strong {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .message.own small {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .message.admin {
            background: linear-gradient(135deg, #ff3b30, #ff9500);
            border: 1px solid rgba(255, 59, 48, 0.3);
            margin-left: 0;
            margin-right: auto;
            position: relative;
        }
        
        .message.admin::before {
            content: '👑';
            position: absolute;
            top: -8px;
            left: 16px;
            background: rgba(255, 59, 48, 0.9);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
        }
        
        .message.admin strong {
            color: rgba(255, 255, 255, 0.95);
            font-weight: 700;
        }
        
        .message.admin small {
            color: rgba(255, 255, 255, 0.8);
        }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .message strong {
            color: #007aff;
            font-weight: 600;
        }
        
        .message small {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
        }
        
        .system-message {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            font-style: italic;
            color: rgba(255, 255, 255, 0.7);
            margin: 12px auto;
            max-width: 70%;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        .admin-panel {
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.8);
            border-top: 1px solid #333;
            display: flex;
            justify-content: center;
            gap: 8px;
        }
        
        .admin-toggle {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #ff77c6;
            color: #ff77c6;
            padding: 8px 12px;
            border-radius: 0;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            width: auto;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Courier New', monospace;
        }
        
        .admin-toggle.active {
            background: rgba(255, 119, 198, 0.2);
            color: #fff;
            border-color: #ff77c6;
            box-shadow: 0 0 10px rgba(255, 119, 198, 0.3);
        }
        
        .admin-toggle:hover {
            background: rgba(255, 119, 198, 0.1);
            box-shadow: 0 0 15px rgba(255, 119, 198, 0.3);
        }
        
        .disco-btn {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #7877c6;
            color: #7877c6;
            padding: 8px 12px;
            border-radius: 0;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Courier New', monospace;
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .disco-btn:hover {
            background: rgba(120, 119, 198, 0.1);
            box-shadow: 0 0 15px rgba(120, 119, 198, 0.3);
        }
        
        .disco-settings {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            width: 400px;
            max-width: 90vw;
            z-index: 1000;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }
        
        .settings-header {
            padding: 20px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-header h3 {
            margin: 0;
            color: #ffffff;
            font-size: 18px;
            font-weight: 600;
        }
        
        .close-settings {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: rgba(255, 255, 255, 0.7);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .close-settings:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }
        
        .settings-content {
            padding: 20px 24px;
        }
        
        .setting-group {
            margin-bottom: 20px;
        }
        
        .setting-group label {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .setting-group input[type="range"] {
            width: 70%;
            margin-right: 10px;
            accent-color: #007aff;
        }
        
        .setting-group span {
            color: #007aff;
            font-weight: 600;
            min-width: 40px;
            display: inline-block;
        }
        
        .setting-group select {
            width: 100%;
            padding: 10px 16px;
            background: rgba(58, 58, 60, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #ffffff;
            font-size: 14px;
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            margin-bottom: 0;
        }
        
        .checkbox-group input[type="checkbox"] {
            accent-color: #007aff;
        }
        
        .hammer-btn {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #77ffc6;
            color: #77ffc6;
            padding: 8px 12px;
            border-radius: 0;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Courier New', monospace;
        }
        
        .hammer-btn:hover {
            background: rgba(119, 255, 198, 0.1);
            box-shadow: 0 0 15px rgba(119, 255, 198, 0.3);
        }
        
        .hammer-cursor {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><text y="24" font-size="24">🔨</text></svg>'), auto !important;
        }
        
        .hammer-cursor * {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><text y="24" font-size="24">🔨</text></svg>'), auto !important;
        }
        
        .cracked {
            position: relative;
            animation: crack 0.5s ease-out;
        }
        
        .cracked::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M20,10 L25,30 L15,50 L30,70 L10,90" stroke="%23ff0000" stroke-width="2" fill="none"/><path d="M80,5 L70,25 L85,45 L75,65 L90,85" stroke="%23ff0000" stroke-width="2" fill="none"/><path d="M50,15 L45,35 L55,55 L40,75" stroke="%23ff0000" stroke-width="2" fill="none"/></svg>') no-repeat center;
            background-size: cover;
            pointer-events: none;
            z-index: 10;
        }
        
        @keyframes crack {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(-2deg); }
            50% { transform: scale(0.95) rotate(2deg); }
            75% { transform: scale(1.02) rotate(-1deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        .shattered {
            animation: shatter 1s ease-out forwards;
        }
        
        @keyframes shatter {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1) rotate(5deg); opacity: 0.7; }
            100% { transform: scale(0) rotate(180deg); opacity: 0; }
        }
        
        .users-section {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 16px 0;
        }
        
        .users-header {
            padding: 0 20px 12px;
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .users-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .user-item {
            padding: 8px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }
        
        .user-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .user-status.online {
            background: #34c759;
            box-shadow: 0 0 4px rgba(52, 199, 89, 0.5);
        }
        
        .user-status.offline {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .user-name {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .user-name.offline {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .hammer-animation {
            position: fixed;
            font-size: 48px;
            pointer-events: none;
            z-index: 9999;
            animation: hammerSwing 0.8s ease-out;
        }
        
        @keyframes hammerSwing {
            0% {
                transform: rotate(-45deg) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: rotate(0deg) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: rotate(45deg) scale(0.8);
                opacity: 0;
            }
        }
        
        .disco-mode {
            animation: discoFlash var(--disco-speed, 0.5s) infinite;
        }
        
        .disco-mode.shake {
            animation: discoFlash var(--disco-speed, 0.5s) infinite, shake 0.1s infinite;
        }
        
        .disco-mode.rotate {
            animation: discoFlash var(--disco-speed, 0.5s) infinite, rotate 2s linear infinite;
        }
        
        .disco-mode.pulse {
            animation: discoFlash var(--disco-speed, 0.5s) infinite, pulse 1s ease-in-out infinite;
        }
        
        @keyframes discoFlash {
            0% { 
                background: var(--disco-color-1, linear-gradient(45deg, #7877c6, #ff77c6));
                background-image: 
                    radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.8) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.8) 0%, transparent 50%),
                    radial-gradient(circle at 40% 40%, rgba(120, 255, 198, 0.6) 0%, transparent 50%);
            }
            25% { 
                background: var(--disco-color-2, linear-gradient(45deg, #ff77c6, #77ffc6));
                background-image: 
                    radial-gradient(circle at 60% 20%, rgba(255, 119, 198, 0.8) 0%, transparent 50%),
                    radial-gradient(circle at 20% 60%, rgba(119, 255, 198, 0.8) 0%, transparent 50%),
                    radial-gradient(circle at 80% 80%, rgba(120, 119, 198, 0.6) 0%, transparent 50%);
            }
            50% { 
                background: var(--disco-color-3, linear-gradient(45deg, #77ffc6, #7877c6));
                background-image: 
                    radial-gradient(circle at 80% 60%, rgba(119, 255, 198, 0.8) 0%, transparent 50%),
                    radial-gradient(circle at 40% 20%, rgba(120, 119, 198, 0.8) 0%, transparent 50%),
                    radial-gradient(circle at 20% 80%, rgba(255, 119, 198, 0.6) 0%, transparent 50%);
            }
            75% { 
                background: var(--disco-color-4, linear-gradient(45deg, #c677ff, #77c6ff));
                background-image: 
                    radial-gradient(circle at 40% 60%, rgba(198, 119, 255, 0.8) 0%, transparent 50%),
                    radial-gradient(circle at 80% 40%, rgba(119, 198, 255, 0.8) 0%, transparent 50%),
                    radial-gradient(circle at 60% 80%, rgba(255, 119, 198, 0.6) 0%, transparent 50%);
            }
            100% { 
                background: var(--disco-color-1, linear-gradient(45deg, #7877c6, #ff77c6));
                background-image: 
                    radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.8) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.8) 0%, transparent 50%),
                    radial-gradient(circle at 40% 40%, rgba(120, 255, 198, 0.6) 0%, transparent 50%);
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .disco-message {
            background: linear-gradient(135deg, #7877c6, #ff77c6, #77ffc6, #c677ff, #77c6ff) !important;
            background-size: 300% 300% !important;
            animation: rainbow 1s ease-in-out infinite, pulse 1s ease-in-out infinite !important;
            border: 2px solid #fff !important;
            box-shadow: 0 0 20px rgba(120, 119, 198, 0.8), 0 0 40px rgba(255, 119, 198, 0.6) !important;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8) !important;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .input-area.admin-mode {
            border-top: 2px solid rgba(255, 59, 48, 0.3);
            background: rgba(255, 59, 48, 0.05);
        }
        
        .input-area.admin-mode #messageInput {
            border-color: rgba(255, 59, 48, 0.3);
        }
        
        .input-area.admin-mode #messageInput:focus {
            border-color: rgba(255, 59, 48, 0.6);
            box-shadow: 0 0 0 4px rgba(255, 59, 48, 0.1);
        }
        
        .send-btn.admin-mode {
            background: linear-gradient(135deg, #ff3b30, #ff9500);
            border-color: rgba(255, 59, 48, 0.3);
        }
        
        .send-btn.admin-mode:hover {
            background: linear-gradient(135deg, #e6342a, #e6850a);
        }
        
        .message.admin {
            background: linear-gradient(135deg, #ff3b30, #ff9500);
            border: 1px solid rgba(255, 59, 48, 0.3);
            margin-left: 0;
            margin-right: auto;
            position: relative;
        }
        
        .message.admin::before {
            content: '👑';
            position: absolute;
            top: -8px;
            left: 16px;
            background: rgba(255, 59, 48, 0.9);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
        }
        
        .message.admin strong {
            color: rgba(255, 255, 255, 0.95);
            font-weight: 700;
        }
        
        .message.admin small {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .input-area {
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.8);
            border-top: 1px solid #333;
            display: flex;
            gap: 10px;
            align-items: center;
            position: relative;
        }
        
        #messageInput {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #333;
            border-radius: 0;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            transition: all 0.2s ease;
            font-family: 'Courier New', monospace;
        }
        
        #messageInput:focus {
            outline: none;
            border-color: #7877c6;
            box-shadow: 0 0 10px rgba(120, 119, 198, 0.3);
        }
        
        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 0;
            background: rgba(0, 0, 0, 0.9);
            color: #7877c6;
            border: 1px solid #7877c6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s ease;
        }
        
        .send-btn:hover {
            background: rgba(120, 119, 198, 0.2);
            color: #fff;
            box-shadow: 0 0 15px rgba(120, 119, 198, 0.4);
        }
        
        .send-btn:active {
            transform: scale(0.9);
        }
        
        .gift-btn {
            width: 40px;
            height: 40px;
            border-radius: 0;
            background: rgba(0, 0, 0, 0.9);
            color: #ff77c6;
            border: 1px solid #ff77c6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s ease;
        }
        
        .gift-btn:hover {
            background: rgba(255, 119, 198, 0.2);
            color: #fff;
            box-shadow: 0 0 15px rgba(255, 119, 198, 0.4);
        }
        
        .gift-panel {
            position: absolute;
            bottom: 80px;
            left: 24px;
            right: 24px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid #333;
            border-radius: 0;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            overflow: hidden;
        }
        
        .gift-panel::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            animation: shimmer 4s linear infinite;
            pointer-events: none;
        }
        
        @keyframes panelGlow {
            0% { box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1) inset; }
            100% { box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.2) inset, 0 0 100px rgba(255, 255, 255, 0.1); }
        }
        
        .gift-header {
            padding: 20px 24px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .gift-header h3 {
            margin: 0;
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Courier New', monospace;
        }
        
        .close-gift {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            color: rgba(255, 255, 255, 0.7);
            width: 32px;
            height: 32px;
            border-radius: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .close-gift:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }
        
        .gift-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            padding: 20px 24px;
        }
        
        .gift-item {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #333;
            border-radius: 0;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .gift-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .gift-item:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 149, 0, 0.6);
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 35px rgba(255, 149, 0, 0.2);
        }
        
        .gift-item:hover::before {
            opacity: 1;
        }
        
        .gift-emoji {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .gift-name {
            color: #ffffff;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Courier New', monospace;
        }
        
        .gift-price {
            color: rgba(255, 149, 0, 1);
            font-size: 12px;
            font-weight: 600;
        }
        
        .gift-message {
            background: linear-gradient(135deg, #ff9500, #ff6b35);
            border: 2px solid rgba(255, 149, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .gift-message::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: giftShine 2s infinite;
        }
        
        @keyframes giftShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        @keyframes giftPop {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8) rotate(360deg);
                opacity: 0;
            }
        }
        
        .gift-content {
            text-align: center;
            padding: 10px;
        }
        
        .gift-emoji-large {
            font-size: 48px;
            margin-bottom: 8px;
            animation: bounce 1s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        .hidden {
            display: none;
        }
        
        .menu-btn {
            display: none;
            position: fixed;
            top: 110px;
            left: 16px;
            background: rgba(0, 122, 255, 0.9);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            z-index: 1001;
            width: 50px;
            height: 50px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }
        
        .sidebar-overlay.show {
            display: block;
        }
        
        @media (max-width: 768px) {
            .chat-app {
                width: 100vw;
                height: 100vh;
                border-radius: 0;
                border: none;
            }
            
            .main-chat {
                width: 100%;
            }
            
            .menu-btn {
                display: block;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 0;
                overflow-x: hidden;
            }
            
            .container {
                width: 100vw;
                height: 100vh;
                border-radius: 0;
                border: none;
            }
            
            .auth-form {
                padding: 20px;
            }
            
            .sidebar {
                width: 85%;
                max-width: 280px;
            }
            
            .gift-panel {
                width: 95%;
                max-width: 95%;
            }
            
            .gift-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .admin-panel {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .admin-toggle, .disco-btn, .hammer-btn {
                padding: 8px 12px;
                font-size: 11px;
                border-radius: 8px;
                min-width: auto;
<<<<<<< HEAD
            }

            #updatesOverlay {
                z-index: 10002 !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                background: rgba(0, 0, 0, 0.5) !important;
                backdrop-filter: blur(5px) !important;
                display: none !important;
                align-items: center !important;
                justify-content: center !important;
            }

            #updatesOverlay {
                z-index: 10002 !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                background: rgba(0, 0, 0, 0.8) !important;
                backdrop-filter: blur(10px) !important;
                display: none !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 10px !important;
            }

            #updatesOverlay > div {
                width: 95% !important;
                max-width: 95% !important;
                max-height: 90vh !important;
                overflow-y: auto !important;
            }

            #updatesOverlay > div > div:last-child {
                flex-direction: column !important;
                gap: 10px !important;
                padding: 15px !important;
            }

            #updatesOverlay table {
                font-size: 12px !important;
            }

            #updatesOverlay h3 {
                font-size: 16px !important;
            }

            #updatesOverlay h4 {
                font-size: 14px !important;
=======
>>>>>>> 81d083bd1f5124259a83f24a4947cb65c8c22156
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Форма авторизации -->
        <div id="authSection">
            <div class="header">
                <h1>💬 Мессенджер</h1>
            </div>
            
            <div style="text-align: center; margin: 20px;">
<<<<<<< HEAD
                <button id="updatesBtn" onclick="showUpdates()" style="padding: 16px 32px; background: linear-gradient(135deg, #007aff, #5856d6); color: white; border: none; border-radius: 16px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.2s ease; box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);" onmouseover="this.style.transform='scale(0.95)'" onmouseout="this.style.transform='scale(1)'">📋 Обновления</button>
=======
                <button id="updatesBtn" style="padding: 16px 32px; background: linear-gradient(135deg, #007aff, #5856d6); color: white; border: none; border-radius: 16px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.2s ease; box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);" onmouseover="this.style.transform='scale(0.95)'" onmouseout="this.style.transform='scale(1)'">📋 Обновления</button>
            </div>
            <!-- Панель обновлений для логина -->
            <div id="updatesOverlay"
                style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); z-index: 9999; align-items: center; justify-content: center;">
                <div style="width: 80%; max-width: 800px; position: relative; background: rgba(28, 28, 30, 0.95); backdrop-filter: blur(40px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5); animation: slideUp 0.3s ease;">
                    <div style="padding: 20px 24px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: space-between; align-items: center;">
                        <div style="text-align: center; font-size: 10px; color: #808080; margin-bottom: 5px;">CLOSED ALPHA 0.2</div>
                        <h3 style="margin: 0; color: #ffffff; font-size: 18px; font-weight: 600;">📋 Обновления</h3>
                        <button onclick="document.getElementById('updatesOverlay').style.display='none'" style="background: rgba(255, 255, 255, 0.1); border: none; color: rgba(255, 255, 255, 0.7); width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;">✕</button>
                    </div>
                    <div style="display: flex; gap: 20px; padding: 20px 24px;">
                        <div style="flex: 2;">
                            <h4 style="color: #ffffff; margin: 0 0 15px 0; font-size: 16px; text-align: center;">🆕 Последние обновления v2.0</h4>
                            <table style="width: 100%; color: rgba(255, 255, 255, 0.9); font-size: 14px; border-collapse: collapse;">
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 8px 0; width: 40px;">⭐</td>
                                    <td style="padding: 8px 0;">Система звезд и подарков</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 8px 0;">👑</td>
                                    <td style="padding: 8px 0;">Раздача звезд админом</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 8px 0;">🎁</td>
                                    <td style="padding: 8px 0;">Подарки с анимацией</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 8px 0;">📞</td>
                                    <td style="padding: 8px 0;">Голосовые звонки</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 8px 0;">🕺</td>
                                    <td style="padding: 8px 0;">Дискотека с настройками</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 8px 0;">🔨</td>
                                    <td style="padding: 8px 0;">Режим молота</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 8px 0;">💬</td>
                                    <td style="padding: 8px 0;">Личные сообщения</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px 0;">💾</td>
                                    <td style="padding: 8px 0;">Сохранение данных</td>
                                </tr>
                            </table>
                        </div>
                        <div style="flex: 1;">
                            <h4 style="color: #ffffff; margin: 0 0 15px 0; font-size: 14px; text-align: center;">📅 Предыдущие версии</h4>
                            <div style="color: rgba(255, 255, 255, 0.7); font-size: 12px; line-height: 1.6;">
                                <div style="margin-bottom: 10px; padding: 6px; background: rgba(0, 122, 255, 0.1); border-radius: 6px;">
                                    <div style="font-weight: 600; color: #007aff;">v1.5</div>
                                    <div>Авторизация и чат</div>
                                </div>
                                <div style="margin-bottom: 10px; padding: 6px; background: rgba(255, 149, 0, 0.1); border-radius: 6px;">
                                    <div style="font-weight: 600; color: #ff9500;">v1.0</div>
                                    <div>Основной чат</div>
                                </div>
                                <div style="margin-bottom: 10px; padding: 6px; background: rgba(52, 199, 89, 0.1); border-radius: 6px;">
                                    <div style="font-weight: 600; color: #34c759;">v0.5</div>
                                    <div>Прототип</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
>>>>>>> 81d083bd1f5124259a83f24a4947cb65c8c22156
            </div>
            <script>
                document.getElementById('updatesBtn').onclick = function() {
                    document.getElementById('updatesOverlay').style.display = 'flex';
                };
            </script>
            
            <div class="auth-form">
                <div class="form-group">
                    <label for="username">👤 Имя пользователя</label>
                    <div class="input-wrapper">
                        <input type="text" id="username" placeholder="Введите ваше имя">
                    </div>
                </div>
                <div class="form-group">
                    <label for="password">🔒 Пароль</label>
                    <div class="input-wrapper">
                        <input type="password" id="password" placeholder="Введите пароль">
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn-primary" onclick="login()">Войти</button>
                    <button class="btn-secondary" onclick="register()">Регистрация</button>
                </div>
                <div id="authError" class="error-message hidden"></div>
            </div>
        </div>
        
        <!-- Чат (скрыт до авторизации) -->
        <div id="chatSection" class="hidden">
            <div class="chat-app">
                <!-- Боковая панель с чатами -->
                <div class="sidebar" id="sidebar">
                    <div class="sidebar-resizer" id="sidebarResizer"></div>
                    <div class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()" title="Свернуть/развернуть">
                        ◀
                    </div>
                    <div class="sidebar-header">
                        <div class="sidebar-title">💬 Чаты</div>
                        <button class="logout-btn" onclick="logout()" style="margin-top: 12px;">
                            🚪 Выйти
                        </button>
                    </div>
                    <div class="chat-list" id="chatList">
                        <div class="chat-item active" onclick="selectChat('general')">
                            <div class="chat-avatar">🌍</div>
                            <div class="chat-info">
                                <div class="chat-name">Общий чат</div>
                                <div class="chat-preview">Последнее сообщение...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="users-section">
                        <div class="users-header">👥 Пользователи</div>
                        <div class="users-list" id="usersList"></div>
                    </div>
                </div>
                
                <!-- Кнопка меню и overlay -->
                <button class="menu-btn" onclick="toggleSidebar()">☰</button>
                <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
                
                <!-- Основной чат -->
                <div class="main-chat">
                    <div class="chat-container">
                        <div class="user-info">
                            <span>🌍 Общий чат</span>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div>
                                    <button onclick="showUpdates()"
                                        style="padding: 8px 12px; background: rgba(0, 0, 0, 0.9); color: #7877c6; border: 1px solid #7877c6; border-radius: 0; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.2s ease; text-transform: uppercase; letter-spacing: 1px; font-family: 'Courier New', monospace;">📋
                                        Обновления</button>
                                </div>
                                <div style="position: relative;">
                                    <button id="themeMenuBtn" onclick="toggleThemeMenu()"
                                        style="padding: 8px 12px; background: rgba(0, 0, 0, 0.9); color: #ff77c6; border: 1px solid #ff77c6; border-radius: 0; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); text-transform: uppercase; letter-spacing: 1px; font-family: 'Courier New', monospace; position: relative; overflow: hidden;">🎨
                                        Темы</button>
                                </div>
                                <span id="starsCounter" style="font-size: 14px; color: #ff77c6; font-weight: 600;">⭐ 0</span>
                                <span id="currentUser" style="font-size: 14px; opacity: 0.7;"></span>
                            </div>
                        </div>
                        
                        <div id="messages"></div>
                        
                        <div class="input-area" id="inputArea">
                            <button class="gift-btn" onclick="toggleGiftPanel()" title="Подарки">🎁</button>
                            <input id="messageInput" type="text" placeholder="Напишите сообщение..." maxlength="200">
                            <button class="send-btn" id="sendBtn" onclick="sendMessage()">🚀</button>
                        </div>
                        

                        
                        <!-- Меню тем -->
                        <div id="themeMenu" style="display: none; position: absolute; top: 60px; right: 20px; background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(20px); border: 1px solid #333; border-radius: 8px; padding: 8px; z-index: 10001; min-width: 200px; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0; transform: translateY(-10px);">
                            <div class="theme-option" onclick="setTheme('dark')" style="padding: 12px 16px; cursor: pointer; border-radius: 4px; transition: all 0.2s ease; display: flex; align-items: center; gap: 12px; color: #fff; font-family: 'Courier New', monospace; font-size: 14px;">
                                <span>🌙</span>
                                <span>Темная</span>
                            </div>
                            <div class="theme-option" onclick="setTheme('light')" style="padding: 12px 16px; cursor: pointer; border-radius: 4px; transition: all 0.2s ease; display: flex; align-items: center; gap: 12px; color: #fff; font-family: 'Courier New', monospace; font-size: 14px;">
                                <span>☀️</span>
                                <span>Светлая</span>
                            </div>
                            <div class="theme-option" onclick="setTheme('purple')" style="padding: 12px 16px; cursor: pointer; border-radius: 4px; transition: all 0.2s ease; display: flex; align-items: center; gap: 12px; color: #fff; font-family: 'Courier New', monospace; font-size: 14px;">
                                <span>🔮</span>
                                <span>Фиолетовая</span>
                            </div>
                            <div class="theme-option" onclick="setTheme('green')" style="padding: 12px 16px; cursor: pointer; border-radius: 4px; transition: all 0.2s ease; display: flex; align-items: center; gap: 12px; color: #fff; font-family: 'Courier New', monospace; font-size: 14px;">
                                <span>🌿</span>
                                <span>Зеленая</span>
                            </div>
                            <div class="theme-option" onclick="setTheme('retro')" style="padding: 12px 16px; cursor: pointer; border-radius: 4px; transition: all 0.2s ease; display: flex; align-items: center; gap: 12px; color: #fff; font-family: 'Courier New', monospace; font-size: 14px;">
                                <span>📟</span>
                                <span>Ретро</span>
                            </div>
                            <div class="theme-option" onclick="setTheme('glass')" style="padding: 12px 16px; cursor: pointer; border-radius: 4px; transition: all 0.2s ease; display: flex; align-items: center; gap: 12px; color: #fff; font-family: 'Courier New', monospace; font-size: 14px;">
                                <span>💎</span>
                                <span>Стекло</span>
                            </div>
                        </div>
                        
                        <!-- Панель раздачи звезд -->
                        <div class="gift-panel" id="starsPanel" style="display: none;">
                            <div class="gift-header">
                                <h3>⭐ Раздать звезды</h3>
                                <button class="close-gift" onclick="hideStarsPanel()">✕</button>
                            </div>
                            <div style="padding: 20px 24px;">
                                <select id="starRecipient" style="width: 100%; padding: 12px; margin-bottom: 15px; background: rgba(58, 58, 60, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: #ffffff;"></select>
                                <input type="number" id="starAmount" placeholder="Количество звезд" min="1" style="width: 100%; padding: 12px; margin-bottom: 15px; background: rgba(58, 58, 60, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: #ffffff;">
                                <button onclick="giveStars()" style="width: 100%; padding: 12px; background: #ff9500; color: white; border: none; border-radius: 12px; cursor: pointer;">Раздать</button>
                            </div>
                        </div>
                        
                        <!-- Панель создания ссылки -->
                        <div class="gift-panel" id="linkPanel" style="display: none;">
                            <div class="gift-header">
                                <h3>🔗 Создать ссылку</h3>
                                <button class="close-gift" onclick="hideLinkPanel()">✕</button>
                            </div>
                            <div style="padding: 20px 24px;">
                                <input type="number" id="linkStars" placeholder="Количество звезд" min="1" style="width: 100%; padding: 12px; margin-bottom: 15px; background: rgba(58, 58, 60, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: #ffffff;">
                                <input type="text" id="linkMessage" placeholder="Сообщение (необязательно)" style="width: 100%; padding: 12px; margin-bottom: 15px; background: rgba(58, 58, 60, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: #ffffff;">
                                <button onclick="createStarLink()" style="width: 100%; padding: 12px; background: #007aff; color: white; border: none; border-radius: 12px; cursor: pointer; margin-bottom: 15px;">Создать ссылку</button>
                                <div id="generatedLink" style="display: none;">
                                    <input type="text" id="linkText" readonly style="width: 100%; padding: 12px; margin-bottom: 10px; background: rgba(58, 58, 60, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: #ffffff;">
                                    <button onclick="copyLink()" style="width: 100%; padding: 12px; background: #34c759; color: white; border: none; border-radius: 12px; cursor: pointer;">Копировать</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Панель подарков -->
                        <div class="gift-panel" id="giftPanel" style="display: none;">
                            <div class="gift-header">
                                <h3>🎁 Подарки</h3>
                                <button class="close-gift" onclick="toggleGiftPanel()">✕</button>
                            </div>
                            <div class="gift-grid">
                                <div class="gift-item" onclick="sendGift('🌹', 'Роза')">
                                    <div class="gift-emoji">🌹</div>
                                    <div class="gift-name">Роза</div>
                                    <div class="gift-price">10 ⭐</div>
                                </div>
                                <div class="gift-item" onclick="sendGift('🎂', 'Торт')">
                                    <div class="gift-emoji">🎂</div>
                                    <div class="gift-name">Торт</div>
                                    <div class="gift-price">25 ⭐</div>
                                </div>
                                <div class="gift-item" onclick="sendGift('💎', 'Алмаз')">
                                    <div class="gift-emoji">💎</div>
                                    <div class="gift-name">Алмаз</div>
                                    <div class="gift-price">100 ⭐</div>
                                </div>
                                <div class="gift-item" onclick="sendGift('🎆', 'Фейерверк')">
                                    <div class="gift-emoji">🎆</div>
                                    <div class="gift-name">Фейерверк</div>
                                    <div class="gift-price">50 ⭐</div>
                                </div>
                                <div class="gift-item" onclick="sendGift('🎁', 'Подарок')">
                                    <div class="gift-emoji">🎁</div>
                                    <div class="gift-name">Подарок</div>
                                    <div class="gift-price">30 ⭐</div>
                                </div>
                                <div class="gift-item" onclick="sendGift('👑', 'Корона')">
                                    <div class="gift-emoji">👑</div>
                                    <div class="gift-name">Корона</div>
                                    <div class="gift-price">200 ⭐</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-panel" id="adminPanel" style="display: none;">
                            <button class="admin-toggle" id="adminToggle" onclick="toggleAdminMode()">👑 главный хуй</button>
                            <button class="disco-btn" onclick="toggleDiscoSettings()">⚙️ Настройки</button>
                            <button class="disco-btn" onclick="startDisco()">🕺 Дискотека</button>
                            <button class="hammer-btn" onclick="startHammer()">🔨 Молот</button>
                            <button class="disco-btn" onclick="showStarsPanel()">⭐ Раздать звезды</button>
                            <button class="disco-btn" onclick="showLinkPanel()">🔗 Создать ссылку</button>
                            <button class="disco-btn" onclick="showUpdates()">📋 Обновления</button>
                        </div>
                        
                        <!-- Панель настроек дискотеки -->
                        <div class="disco-settings" id="discoSettings" style="display: none;">
                            <div class="settings-header">
                                <h3>🕺 Настройки дискотеки</h3>
                                <button class="close-settings" onclick="toggleDiscoSettings()">✕</button>
                            </div>
                            <div class="settings-content">
                                <div class="setting-group">
                                    <label>⏱️ Длительность (сек):</label>
                                    <input type="range" id="discoDuration" min="3" max="30" value="5">
                                    <span id="durationValue">5</span>
                                </div>
                                <div class="setting-group">
                                    <label>⚡ Скорость анимации:</label>
                                    <input type="range" id="discoSpeed" min="0.1" max="2" step="0.1" value="0.5">
                                    <span id="speedValue">0.5</span>
                                </div>
                                <div class="setting-group">
                                    <label>🎨 Цветовая схема:</label>
                                    <select id="colorScheme">
                                        <option value="rainbow">🌈 Радуга</option>
                                        <option value="neon">💫 Неон</option>
                                        <option value="fire">🔥 Огонь</option>
                                        <option value="ocean">🌊 Океан</option>
                                        <option value="sunset">🌅 Закат</option>
                                    </select>
                                </div>
                                <div class="setting-group">
                                    <label>💥 Интенсивность:</label>
                                    <input type="range" id="discoIntensity" min="1" max="5" value="3">
                                    <span id="intensityValue">3</span>
                                </div>
                                <div class="setting-group">
                                    <label>🎵 Эффекты:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="pulseEffect" checked> Пульсация</label>
                                        <label><input type="checkbox" id="shakeEffect"> Тряска</label>
                                        <label><input type="checkbox" id="rotateEffect"> Вращение</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function showUpdatesPanel() {
            document.getElementById('updatesOverlay').style.display = 'flex';
        }
        
<<<<<<< HEAD
        function showUpdates() {
            console.log('Show updates called');
            const overlay = document.getElementById('updatesOverlay');
            if (overlay) {
                console.log('Overlay found, displaying');
                overlay.style.display = 'flex';
                // Блокируем прокрутку body при открытой панели
                document.body.style.overflow = 'hidden';
            } else {
                console.log('Overlay not found');
            }
        }

        function hideUpdatesPanel() {
            console.log('Hide updates called');
            const overlay = document.getElementById('updatesOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                // Восстанавливаем прокрутку body
                document.body.style.overflow = '';
            }
        }

// Удалите дублирующиеся функции showUpdatesPanel() если они есть
=======
        function hideUpdatesPanel() {
            document.getElementById('updatesOverlay').style.display = 'none';
        }
>>>>>>> 81d083bd1f5124259a83f24a4947cb65c8c22156
    </script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket;
        let currentUser = null;
        let token = localStorage.getItem('token');
        
        let activeChat = 'general';
        let privateChats = new Map();
        let generalMessages = [];
        let localStream = null;
        let remoteStream = null;
        let peerConnection = null;
        let currentCall = null;
        let userStars = 0;
        
        // Конфигурация WebRTC
        const pcConfig = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' }
            ]
        };
        
        // Создание PeerConnection
        async function createPeerConnection() {
            try {
                peerConnection = new RTCPeerConnection(pcConfig);
                
                // Добавляем локальные треки
                if (localStream) {
                    localStream.getTracks().forEach(track => {
                        peerConnection.addTrack(track, localStream);
                    });
                }
                
                // Обработчик удаленного потока
                peerConnection.ontrack = (event) => {
                    console.log('Получен удаленный поток:', event.streams[0]);
                    remoteStream = event.streams[0];
                    displayRemoteVideo();
                };
                
                // Обработчик ICE кандидатов
                peerConnection.onicecandidate = (event) => {
                    if (event.candidate && currentCall) {
                        socket.emit('webrtc_ice_candidate', {
                            to: currentCall,
                            candidate: event.candidate
                        });
                    }
                };
                
                // Отслеживание состояния соединения
                peerConnection.onconnectionstatechange = () => {
                    console.log('Connection state:', peerConnection.connectionState);
                };
                
            } catch (error) {
                console.error('Ошибка создания PeerConnection:', error);
            }
        }
        
        // Начать звонок
        async function startCall(username) {
            try {
                console.log('Начинаем звонок пользователю:', username);
                
                // Получаем медиапоток
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });
                
                currentCall = username;
                
                // Создаем PeerConnection
                await createPeerConnection();
                
                // Создаем offer
                const offer = await peerConnection.createOffer();
                await peerConnection.setLocalDescription(offer);
                
                // Отправляем offer
                socket.emit('webrtc_offer', {
                    to: username,
                    offer: offer
                });
                
                showCallNotification(`📞 Звоним ${username}...`, 'outgoing');
                
            } catch (error) {
                console.error('Ошибка начала звонка:', error);
                alert('Не удалось начать звонок. Проверьте разрешения для камеры и микрофона.');
            }
        }
        
        // Принять звонок
        async function acceptCall() {
            try {
                console.log('Принимаем звонок от:', currentCall);
                
                // Получаем медиапоток
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });
                
                // Создаем PeerConnection
                await createPeerConnection();
                
                // Устанавливаем удаленное описание (offer)
                await peerConnection.setRemoteDescription(window.incomingOffer);
                
                // Создаем answer
                const answer = await peerConnection.createAnswer();
                await peerConnection.setLocalDescription(answer);
                
                // Отправляем answer
                socket.emit('webrtc_answer', {
                    to: currentCall,
                    answer: answer
                });
                
                removeCallNotification();
                showActiveCall(currentCall);
                
            } catch (error) {
                console.error('Ошибка принятия звонка:', error);
                alert('Не удалось принять звонок.');
                rejectCall();
            }
        }
        
        // Отклонить звонок
        function rejectCall() {
            socket.emit('call_rejected', { to: currentCall });
            removeCallNotification();
            currentCall = null;
        }
        
        // Завершить звонок
        function endCall() {
            if (peerConnection) {
                peerConnection.close();
                peerConnection = null;
            }
            
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            
            if (currentCall) {
                socket.emit('call_ended', { to: currentCall });
                currentCall = null;
            }
            
            removeCallNotification();
            displaySystemMessage('📞 Звонок завершен');
        }
        
        // Показать удаленное видео
        function displayRemoteVideo() {
            const remoteVideo = document.getElementById('remoteVideo');
            const callAvatar = document.getElementById('callAvatar');
            
            if (remoteVideo && remoteStream) {
                remoteVideo.srcObject = remoteStream;
                remoteVideo.style.display = 'block';
                
                if (callAvatar) {
                    callAvatar.style.display = 'none';
                }
                
                console.log('Удаленное видео отображено');
            }
        }
        
        window.onload = function() {
            // Проверяем ссылку на звезды
            const urlParams = new URLSearchParams(window.location.search);
            const stars = urlParams.get('stars');
            const linkId = urlParams.get('id');
            
            if (stars && linkId) {
                localStorage.setItem('starLink', JSON.stringify({ stars: parseInt(stars), linkId }));
            }
            
            if (token) {
                connectToChat();
            }
            
            // Инициализация обработчиков настроек
            setTimeout(() => {
                const durationSlider = document.getElementById('discoDuration');
                const speedSlider = document.getElementById('discoSpeed');
                const intensitySlider = document.getElementById('discoIntensity');
                
                if (durationSlider) {
                    durationSlider.addEventListener('input', function() {
                        document.getElementById('durationValue').textContent = this.value;
                    });
                }
                
                if (speedSlider) {
                    speedSlider.addEventListener('input', function() {
                        document.getElementById('speedValue').textContent = this.value;
                    });
                }
                
                if (intensitySlider) {
                    intensitySlider.addEventListener('input', function() {
                        document.getElementById('intensityValue').textContent = this.value;
                    });
                }
            }, 100);
        };
        
        function selectChat(chatId) {
            // Сохраняем текущие сообщения
            if (activeChat === 'general') {
                generalMessages = Array.from(document.querySelectorAll('#messages .message')).map(msg => msg.outerHTML);
            }
            
            activeChat = chatId;
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';
            
            if (chatId === 'general') {
                document.querySelector('.user-info span:first-child').innerHTML = '🌍 Общий чат';
                // Восстанавливаем общие сообщения
                generalMessages.forEach(msgHTML => {
                    messagesDiv.innerHTML += msgHTML;
                });
            }
            scrollToBottom();
        }
        
        async function register() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showAuthError('Заполните все поля');
                return;
            }
            
            try {
                const response = await fetch('/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    token = data.token;
                    currentUser = data.username;
                    localStorage.setItem('token', token);
                    connectToChat();
                } else {
                    showAuthError(data.error);
                }
            } catch (error) {
                showAuthError('Ошибка соединения');
            }
        }
        
        async function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showAuthError('Заполните все поля');
                return;
            }
            
            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    token = data.token;
                    currentUser = data.username;
                    localStorage.setItem('token', token);
                    connectToChat();
                } else {
                    showAuthError(data.error);
                }
            } catch (error) {
                showAuthError('Ошибка соединения');
            }
        }
        
        function connectToChat() {
            socket = io();
            
            socket.emit('authenticate', token);
            
            socket.on('message_history', (messages) => {
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('chatSection').classList.remove('hidden');
                
                // Получаем имя пользователя из токена
                if (token) {
                    try {
                        const payload = JSON.parse(atob(token.split('.')[1]));
                        currentUser = payload.username;
                        console.log('User from token:', currentUser);
                    } catch (e) {
                        console.error('Error parsing token:', e);
                    }
                }
                
                document.getElementById('currentUser').textContent = currentUser;
            
            // Инициализируем звезды
            if (currentUser === 'admin') {
                userStars = Infinity;
            } else {
                userStars = 0;
            }
            updateStarsDisplay();
                
                // Показываем кнопку админа если пользователь admin
                console.log('Current user:', currentUser);
                if (currentUser === 'admin') {
                    console.log('Showing admin button');
                    document.getElementById('adminPanel').style.display = 'flex';
                } else {
                    console.log('Not admin user, hiding button');
                }
                
                const messagesDiv = document.getElementById('messages');
                messagesDiv.innerHTML = '';
                messages.forEach(displayMessage);
                // Сохраняем общие сообщения
                generalMessages = messages.map(msg => createMessageHTML(msg));
                scrollToBottom();
            });
            
            socket.on('new_message', (message) => {
                if (activeChat === 'general') {
                    displayMessage(message);
                }
                // Добавляем в общие сообщения для сохранения
                if (activeChat !== 'general') {
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = createMessageHTML(message);
                    generalMessages.push(tempDiv.innerHTML);
                }
            });
            
            socket.on('user_joined', (username) => {
                displaySystemMessage(`${username} присоединился к чату`);
            });
            
            socket.on('user_left', (username) => {
                displaySystemMessage(`${username} покинул чат`);
            });
            
            socket.on('auth_error', (error) => {
                showAuthError(error);
                logout();
            });
            
            socket.on('disco_event', (settings) => {
                console.log('Received disco_event from server with settings:', settings);
                displayDiscoMessage();
                applyDiscoEffect(settings || discoSettings);
            });
            
            socket.on('hammer_event', () => {
                console.log('Received hammer_event from server');
                enableHammerMode();
            });
            
            socket.on('hammer_click', (elementInfo) => {
                console.log('Received hammer_click from server:', elementInfo);
                showHammerAnimation(elementInfo.x, elementInfo.y);
                const target = findElementByInfo(elementInfo);
                if (target && !target.classList.contains('cracked')) {
                    crackElement(target);
                }
            });
            
            socket.on('users_list', (users) => {
                console.log('Received users_list event:', users);
                updateUsersList(users);
            });
            
            socket.on('user_status_changed', (data) => {
                console.log('Received user_status_changed event:', data);
                updateUserStatus(data.username, data.online);
            });
            
            socket.on('private_message', (data) => {
                console.log('Received private message:', data);
                console.log('Current active chat:', activeChat);
                const chatKey = data.sender;
                
                if (!privateChats.has(chatKey)) {
                    privateChats.set(chatKey, []);
                    addPrivateChatToList(chatKey);
                }
                
                privateChats.get(chatKey).push(data);
                console.log('Added message to private chat:', chatKey);
                
                if (activeChat === `private_${chatKey}`) {
                    console.log('Displaying received private message');
                    displayMessage(data);
                } else {
                    console.log('Not displaying - wrong chat. Expected:', `private_${chatKey}`, 'Actual:', activeChat);
                }
            });
            
            socket.on('private_messages_history', (data) => {
                console.log('Received private messages history:', data);
                
                Object.keys(data).forEach(username => {
                    privateChats.set(username, data[username]);
                    addPrivateChatToList(username);
                });
            });
            
            // Обработчик подарков
            socket.on('receive_gift', (giftData) => {
                console.log('Received gift:', giftData);
                displayGiftMessage(giftData, false);
            });
            
            // Обработчики звонков
            socket.on('incoming_call', async (data) => {
                console.log('Incoming call from:', data.caller);
                currentCall = data.caller;
                
                // Сохраняем offer для последующей обработки
                window.incomingOffer = data.offer;
                
                showCallNotification(`📞 Входящий звонок от ${data.caller}`, 'incoming');
            });
            
            socket.on('call_accepted', async (data) => {
                console.log('Call accepted by:', data.user);
                removeCallNotification();
                
                // Обрабатываем answer если мы инициатор звонка
                if (data.answer && peerConnection) {
                    await peerConnection.setRemoteDescription(data.answer);
                }
                
                showActiveCall(data.user);
                displaySystemMessage(`📞 ${data.user} принял звонок. Говорите!`);
            });
            
            socket.on('call_rejected', (data) => {
                console.log('Call rejected by:', data.user);
                removeCallNotification();
                displaySystemMessage(`📞 ${data.user} отклонил звонок`);
            });
            
            socket.on('call_ended', (data) => {
                console.log('Call ended by:', data.user);
                
                // Останавливаем стримы без отправки события
                if (localStream) {
                    localStream.getTracks().forEach(track => track.stop());
                    localStream = null;
                }
                
                if (peerConnection) {
                    peerConnection.close();
                    peerConnection = null;
                }
                
                currentCall = null;
                removeCallNotification();
                displaySystemMessage(`📞 Звонок завершен`);
            });
            
            // WebRTC обработчики
            socket.on('call_offer', async (data) => {
                console.log('Received call offer from:', data.caller);
                currentCall = data.caller;
                
                if (peerConnection) {
                    await peerConnection.setRemoteDescription(data.offer);
                }
            });
            
            socket.on('call_answer', async (data) => {
                console.log('Received call answer');
                
                if (peerConnection) {
                    await peerConnection.setRemoteDescription(data.answer);
                }
            });
            
            socket.on('ice_candidate', async (data) => {
                console.log('Received ICE candidate');
                
                if (peerConnection) {
                    await peerConnection.addIceCandidate(data.candidate);
                }
            });
            
            socket.on('media_track', (data) => {
                console.log('Received media track from:', data.sender);
            });
            
            socket.on('user_stars', (stars) => {
                if (currentUser !== 'admin') {
                    userStars = stars;
                    updateStarsDisplay();
                    
                    // Проверяем ссылку на звезды
                    const starLink = localStorage.getItem('starLink');
                    if (starLink) {
                        const linkData = JSON.parse(starLink);
                        socket.emit('claim_star_link', linkData);
                        localStorage.removeItem('starLink');
                    }
                }
            });
            
            socket.on('receive_stars', (data) => {
                if (currentUser !== 'admin') {
                    userStars += data.amount;
                    updateStarsDisplay();
                    displaySystemMessage(`⭐ Вы получили ${data.amount} звезд от админа!`);
                }
            });
            
            socket.on('star_link_claimed', (data) => {
                if (currentUser !== 'admin') {
                    userStars += data.amount;
                    updateStarsDisplay();
                    let message = `⭐ Вы получили ${data.amount} звезд по ссылке!`;
                    if (data.message) {
                        message += `\n💬 ${data.message}`;
                    }
                    displaySystemMessage(message);
                }
            });
            
            socket.on('star_link_error', (error) => {
                displaySystemMessage(`❌ ${error}`);
            });
            
            // Убрали обработчик private_message_sent чтобы избежать дублирования
        }
        
        let isAdminMode = false;
        
        function toggleAdminMode() {
            isAdminMode = !isAdminMode;
            const toggle = document.getElementById('adminToggle');
            const inputArea = document.getElementById('inputArea');
            const sendBtn = document.getElementById('sendBtn');
            const messageInput = document.getElementById('messageInput');
            
            if (isAdminMode) {
                toggle.classList.add('active');
                toggle.textContent = '👑 Отключить';
                inputArea.classList.add('admin-mode');
                sendBtn.classList.add('admin-mode');
                messageInput.placeholder = 'Админ сообщение...';
            } else {
                toggle.classList.remove('active');
                toggle.textContent = '👑 Админ';
                inputArea.classList.remove('admin-mode');
                sendBtn.classList.remove('admin-mode');
                messageInput.placeholder = 'Напишите сообщение...';
            }
        }
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const messageText = input.value.trim();
            
            if (messageText === '' || !socket) {
                return;
            }
            
            console.log('Sending message. Active chat:', activeChat);
            console.log('Message text:', messageText);
            
            if (activeChat.startsWith('private_')) {
                const recipient = activeChat.replace('private_', '');
                console.log('Sending private message to:', recipient);
                
                // Отображаем сообщение сразу
                const tempMessage = {
                    sender: currentUser,
                    recipient: recipient,
                    text: messageText,
                    time: new Date().toLocaleTimeString(),
                    isPrivate: true
                };
                
                // Добавляем в локальный чат
                if (!privateChats.has(recipient)) {
                    privateChats.set(recipient, []);
                }
                privateChats.get(recipient).push(tempMessage);
                
                // Отображаем
                displayMessage(tempMessage);
                
                socket.emit('private_message', {
                    recipient: recipient,
                    text: messageText
                });
            } else if (isAdminMode && currentUser === 'admin') {
                console.log('Sending admin message');
                socket.emit('admin_message', messageText);
            } else {
                console.log('Sending regular message');
                socket.emit('send_message', messageText);
            }
            
            input.value = '';
        }
        
        let discoSettings = {
            duration: 5,
            speed: 0.5,
            colorScheme: 'rainbow',
            intensity: 3,
            effects: {
                pulse: true,
                shake: false,
                rotate: false
            }
        };
        
        function toggleDiscoSettings() {
            const settings = document.getElementById('discoSettings');
            if (settings.style.display === 'none') {
                settings.style.display = 'block';
                loadDiscoSettings();
            } else {
                settings.style.display = 'none';
                saveDiscoSettings();
            }
        }
        
        function loadDiscoSettings() {
            document.getElementById('discoDuration').value = discoSettings.duration;
            document.getElementById('durationValue').textContent = discoSettings.duration;
            document.getElementById('discoSpeed').value = discoSettings.speed;
            document.getElementById('speedValue').textContent = discoSettings.speed;
            document.getElementById('colorScheme').value = discoSettings.colorScheme;
            document.getElementById('discoIntensity').value = discoSettings.intensity;
            document.getElementById('intensityValue').textContent = discoSettings.intensity;
            document.getElementById('pulseEffect').checked = discoSettings.effects.pulse;
            document.getElementById('shakeEffect').checked = discoSettings.effects.shake;
            document.getElementById('rotateEffect').checked = discoSettings.effects.rotate;
        }
        
        function saveDiscoSettings() {
            discoSettings.duration = parseInt(document.getElementById('discoDuration').value);
            discoSettings.speed = parseFloat(document.getElementById('discoSpeed').value);
            discoSettings.colorScheme = document.getElementById('colorScheme').value;
            discoSettings.intensity = parseInt(document.getElementById('discoIntensity').value);
            discoSettings.effects.pulse = document.getElementById('pulseEffect').checked;
            discoSettings.effects.shake = document.getElementById('shakeEffect').checked;
            discoSettings.effects.rotate = document.getElementById('rotateEffect').checked;
        }
        
        function startDisco() {
            console.log('Starting disco, current user:', currentUser);
            
            if (currentUser !== 'admin') {
                console.log('Access denied - not admin');
                return;
            }
            
            if (!socket) {
                console.log('No socket connection');
                return;
            }
            
            saveDiscoSettings();
            console.log('Emitting disco_event with settings:', discoSettings);
            socket.emit('disco_event', discoSettings);
        }
        
        let hammerMode = false;
        
        function startHammer() {
            if (currentUser !== 'admin') {
                return;
            }
            
            if (!socket) {
                return;
            }
            
            socket.emit('hammer_event');
            enableHammerMode(); // Включаем и у админа
        }
        
        function enableHammerMode() {
            hammerMode = true;
            document.body.classList.add('hammer-cursor');
            
            const hammerMessage = document.createElement('div');
            hammerMessage.className = 'message system-message';
            hammerMessage.innerHTML = '🔨 МОЛОТ АКТИВИРОВАН! Кликайте по элементам чтобы сломать их!';
            document.getElementById('messages').appendChild(hammerMessage);
            scrollToBottom();
            
            document.addEventListener('click', hammerClick);
            
            setTimeout(() => {
                disableHammerMode();
            }, 15000);
        }
        
        function hammerClick(e) {
            if (!hammerMode) return;
            
            const target = e.target;
            if (target.closest('.message') || target.closest('input') || target.closest('button')) {
                e.preventDefault();
                
                if (!target.classList.contains('cracked')) {
                    // Отправляем событие клика всем
                    const elementInfo = getElementInfo(target);
                    if (socket && elementInfo) {
                        elementInfo.x = e.clientX;
                        elementInfo.y = e.clientY;
                        socket.emit('hammer_click', elementInfo);
                    }
                    
                    showHammerAnimation(e.clientX, e.clientY);
                    crackElement(target);
                }
            }
        }
        
        function getElementInfo(element) {
            if (element.closest('.message')) {
                const messageEl = element.closest('.message');
                const messageIndex = Array.from(document.querySelectorAll('.message')).indexOf(messageEl);
                return { type: 'message', index: messageIndex };
            } else if (element.tagName === 'INPUT') {
                return { type: 'input', id: element.id };
            } else if (element.tagName === 'BUTTON') {
                return { type: 'button', id: element.id, className: element.className };
            }
            return null;
        }
        
        function crackElement(target) {
            target.classList.add('cracked');
            setTimeout(() => {
                target.classList.remove('cracked');
                target.classList.add('shattered');
                setTimeout(() => {
                    if (target.closest('.message')) {
                        target.closest('.message').style.display = 'none';
                    } else {
                        target.style.visibility = 'hidden';
                    }
                }, 1000);
            }, 500);
        }
        
        function findElementByInfo(elementInfo) {
            if (elementInfo.type === 'message') {
                const messages = document.querySelectorAll('.message');
                return messages[elementInfo.index];
            } else if (elementInfo.type === 'input') {
                return document.getElementById(elementInfo.id);
            } else if (elementInfo.type === 'button') {
                return document.getElementById(elementInfo.id) || document.querySelector('.' + elementInfo.className.split(' ')[0]);
            }
            return null;
        }
        
        function showHammerAnimation(x, y) {
            console.log('Showing hammer animation at:', x, y);
            const hammer = document.createElement('div');
            hammer.className = 'hammer-animation';
            hammer.innerHTML = '🔨';
            hammer.style.left = (x - 24) + 'px';
            hammer.style.top = (y - 24) + 'px';
            document.body.appendChild(hammer);
            
            setTimeout(() => {
                if (document.body.contains(hammer)) {
                    document.body.removeChild(hammer);
                }
            }, 800);
        }
        
        function updateUsersList(users) {
            console.log('Updating users list:', users);
            const usersList = document.getElementById('usersList');
            if (!usersList) {
                console.error('usersList element not found');
                return;
            }
            
            usersList.innerHTML = '';
            
            users.forEach(user => {
                if (user.username === currentUser) return;
                
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.style.cursor = 'pointer';
                userItem.onclick = () => openPrivateChat(user.username);
                userItem.innerHTML = `
                    <div class="user-status ${user.online ? 'online' : 'offline'}"></div>
                    <div class="user-name ${user.online ? '' : 'offline'}">${user.username}</div>
                `;
                usersList.appendChild(userItem);
            });
            
            updateStarRecipients(users);
            console.log('Users list updated with', users.length, 'users');
        }
        
        function updateStarRecipients(users) {
            const select = document.getElementById('starRecipient');
            if (!select) return;
            
            select.innerHTML = '<option value="">Выберите пользователя</option>';
            users.forEach(user => {
                if (user.username !== currentUser) {
                    const option = document.createElement('option');
                    option.value = user.username;
                    option.textContent = user.username;
                    select.appendChild(option);
                }
            });
        }
        
        function showStarsPanel() {
            if (currentUser !== 'admin') return;
            document.getElementById('starsPanel').style.display = 'block';
        }
        
        function hideStarsPanel() {
            document.getElementById('starsPanel').style.display = 'none';
        }
        
        function showLinkPanel() {
            if (currentUser !== 'admin') return;
            document.getElementById('linkPanel').style.display = 'block';
        }
        
        function hideLinkPanel() {
            document.getElementById('linkPanel').style.display = 'none';
        }
        
        function createStarLink() {
            const stars = parseInt(document.getElementById('linkStars').value);
            const message = document.getElementById('linkMessage').value.trim();
            
            if (!stars || stars < 1) {
                alert('Укажите количество звезд');
                return;
            }
            
            const linkId = Math.random().toString(36).substr(2, 9);
            const link = `${window.location.origin}?stars=${stars}&id=${linkId}`;
            
            socket.emit('create_star_link', { linkId, stars, message });
            
            document.getElementById('linkText').value = link;
            document.getElementById('generatedLink').style.display = 'block';
        }
        
        function copyLink() {
            const linkText = document.getElementById('linkText');
            linkText.select();
            document.execCommand('copy');
            alert('Ссылка скопирована!');
        }
        
        function giveStars() {
            const recipient = document.getElementById('starRecipient').value;
            const amount = parseInt(document.getElementById('starAmount').value);
            
            if (!recipient || !amount || amount < 1) {
                alert('Выберите пользователя и укажите количество звезд');
                return;
            }
            
            socket.emit('give_stars', { recipient, amount });
            hideStarsPanel();
            document.getElementById('starAmount').value = '';
            displaySystemMessage(`⭐ Админ раздал ${amount} звезд пользователю ${recipient}`);
        }
        

        
        function toggleThemeMenu() {
            const menu = document.getElementById('themeMenu');
            const btn = document.getElementById('themeMenuBtn');
            
            if (menu.style.display === 'none') {
                menu.style.display = 'block';
                menu.style.opacity = '0';
                menu.style.transform = 'translateY(-10px)';
                
                // Animate button
                btn.style.transform = 'scale(1.1)';
                btn.style.boxShadow = '0 0 15px rgba(255, 119, 198, 0.5)';
                
                setTimeout(() => {
                    menu.style.opacity = '1';
                    menu.style.transform = 'translateY(0)';
                }, 10);
            } else {
                menu.style.opacity = '0';
                menu.style.transform = 'translateY(-10px)';
                
                // Reset button
                btn.style.transform = '';
                btn.style.boxShadow = '';
                
                setTimeout(() => {
                    menu.style.display = 'none';
                }, 200);
            }
        }
        
        // Закрытие меню при клике вне его
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('themeMenu');
            const btn = document.getElementById('themeMenuBtn');
            if (menu && !menu.contains(e.target) && e.target !== btn) {
                menu.style.display = 'none';
            }
        });
        
        function setTheme(theme) {
            // Create transition overlay
            const overlay = document.createElement('div');
            overlay.className = 'theme-transition';
            document.body.appendChild(overlay);
            
            // Animate theme button
            const btn = document.getElementById('themeMenuBtn');
            btn.style.transform = 'scale(1.2) rotate(180deg)';
            btn.style.boxShadow = '0 0 30px rgba(255, 119, 198, 0.8)';
            
            setTimeout(() => {
                const body = document.body;
                
                // Remove all theme classes
                body.classList.remove('light-theme', 'purple-theme', 'green-theme', 'retro-theme', 'glass-theme');
                
                // Apply new theme class
                if (theme !== 'dark') {
                    body.classList.add(theme + '-theme');
                }
                
                // Reset button
                btn.style.transform = '';
                btn.style.boxShadow = '';
                
                // Hide theme menu
                document.getElementById('themeMenu').style.display = 'none';
            }, 200);
            
            // Remove overlay
            setTimeout(() => {
                if (document.body.contains(overlay)) {
                    document.body.removeChild(overlay);
                }
            }, 800);
        }
        
        function openPrivateChat(username) {
            activeChat = `private_${username}`;
            
            // Создаем новый чат в списке если его нет
            if (!privateChats.has(username)) {
                privateChats.set(username, []);
                addPrivateChatToList(username);
            }
            
            // Переключаемся на приватный чат
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const privateChatItem = document.querySelector(`[data-chat="private_${username}"]`);
            if (privateChatItem) {
                privateChatItem.classList.add('active');
            }
            
            // Обновляем заголовок чата
            const userInfoSpan = document.querySelector('.user-info span:first-child');
            userInfoSpan.innerHTML = `💬 ЛС с ${username} <button onclick="startCall('${username}')" style="margin-left: 10px; padding: 4px 8px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer;">📞 Позвонить</button>`;
            
            // Показываем сообщения этого чата
            displayPrivateMessages(username);
        }
        
        function addPrivateChatToList(username) {
            const chatList = document.getElementById('chatList');
            
            // Проверяем, нет ли уже такого чата
            if (document.querySelector(`[data-chat="private_${username}"]`)) {
                return;
            }
            
            const chatItem = document.createElement('div');
            chatItem.className = 'chat-item';
            chatItem.setAttribute('data-chat', `private_${username}`);
            chatItem.onclick = () => openPrivateChat(username);
            chatItem.innerHTML = `
                <div class="chat-avatar">👤</div>
                <div class="chat-info">
                    <div class="chat-name">${username}</div>
                    <div class="chat-preview">Личные сообщения</div>
                </div>
            `;
            chatList.appendChild(chatItem);
        }
        
        function displayPrivateMessages(username) {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';
            
            const messages = privateChats.get(username) || [];
            messages.forEach(displayMessage);
            scrollToBottom();
        }
        
        function updateUserStatus(username, online) {
            const userItems = document.querySelectorAll('.user-item');
            userItems.forEach(item => {
                const nameEl = item.querySelector('.user-name');
                if (nameEl.textContent === username) {
                    const statusEl = item.querySelector('.user-status');
                    statusEl.className = `user-status ${online ? 'online' : 'offline'}`;
                    nameEl.className = `user-name ${online ? '' : 'offline'}`;
                }
            });
        }
        
        function disableHammerMode() {
            hammerMode = false;
            document.body.classList.remove('hammer-cursor');
            document.removeEventListener('click', hammerClick);
            
            const hammerMessage = document.createElement('div');
            hammerMessage.className = 'message system-message';
            hammerMessage.innerHTML = '🔨 Молот деактивирован';
            document.getElementById('messages').appendChild(hammerMessage);
            scrollToBottom();
        }
        
        function createMessageHTML(message) {
            const senderName = message.sender || message.username;
            const isOwnMessage = senderName === currentUser;
            const isAdminMessage = message.isAdmin === true;
            const isPrivateMessage = message.isPrivate === true;
            
            let className = 'message';
            let content = '';
            
            if (isAdminMessage) {
                className = 'message admin';
                content = `<strong>АДМИН</strong> <small>(${message.time})</small>: ${message.text}`;
            } else if (isOwnMessage) {
                className = 'message own';
                content = `${message.text} <small>(${message.time})</small>`;
            } else {
                className = 'message';
                content = `<strong>${senderName}</strong> <small>(${message.time})</small>: ${message.text}`;
            }
            
            return `<div class="${className}">${content}</div>`;
        }
        
        function displayMessage(message) {
            console.log('Displaying message:', message);
            const messagesDiv = document.getElementById('messages');
            const messageHTML = createMessageHTML(message);
            messagesDiv.innerHTML += messageHTML;
            scrollToBottom();
        }
        
        function displaySystemMessage(text) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message system-message';
            messageDiv.textContent = text;
            messagesDiv.appendChild(messageDiv);
            scrollToBottom();
        }
        
        function displayDiscoMessage() {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message disco-message';
            messageDiv.innerHTML = `<strong>🕺 ДИСКОТЕКА 🕺</strong><br>Парти стартует! 🎉🎵💃`;
            messagesDiv.appendChild(messageDiv);
            scrollToBottom();
        }
        
        function applyDiscoEffect(settings) {
            const body = document.body;
            
            // Применяем цветовую схему для киберпанк интерфейса
            const colorSchemes = {
                rainbow: {
                    color1: 'linear-gradient(45deg, #7877c6, #ff77c6)',
                    color2: 'linear-gradient(45deg, #ff77c6, #77ffc6)',
                    color3: 'linear-gradient(45deg, #77ffc6, #7877c6)',
                    color4: 'linear-gradient(45deg, #c677ff, #77c6ff)'
                },
                neon: {
                    color1: 'linear-gradient(45deg, #ff0080, #00ff80)',
                    color2: 'linear-gradient(45deg, #8000ff, #ff8000)',
                    color3: 'linear-gradient(45deg, #00ffff, #ff00ff)',
                    color4: 'linear-gradient(45deg, #ffff00, #0080ff)'
                },
                fire: {
                    color1: 'linear-gradient(45deg, #ff4500, #ff6347)',
                    color2: 'linear-gradient(45deg, #ff8c00, #ffd700)',
                    color3: 'linear-gradient(45deg, #dc143c, #ff1493)',
                    color4: 'linear-gradient(45deg, #b22222, #ff4500)'
                },
                ocean: {
                    color1: 'linear-gradient(45deg, #006994, #0099cc)',
                    color2: 'linear-gradient(45deg, #4682b4, #87ceeb)',
                    color3: 'linear-gradient(45deg, #20b2aa, #48d1cc)',
                    color4: 'linear-gradient(45deg, #008b8b, #00ced1)'
                },
                sunset: {
                    color1: 'linear-gradient(45deg, #ff7f50, #ff6347)',
                    color2: 'linear-gradient(45deg, #ffa500, #ff8c00)',
                    color3: 'linear-gradient(45deg, #ff69b4, #ff1493)',
                    color4: 'linear-gradient(45deg, #9370db, #8a2be2)'
                }
            };
            
            const scheme = colorSchemes[settings.colorScheme] || colorSchemes.rainbow;
            
            body.style.setProperty('--disco-color-1', scheme.color1);
            body.style.setProperty('--disco-color-2', scheme.color2);
            body.style.setProperty('--disco-color-3', scheme.color3);
            body.style.setProperty('--disco-color-4', scheme.color4);
            body.style.setProperty('--disco-speed', settings.speed + 's');
            
            // Применяем эффекты к киберпанк элементам
            let classes = ['disco-mode'];
            if (settings.effects.pulse) classes.push('pulse');
            if (settings.effects.shake) classes.push('shake');
            if (settings.effects.rotate) classes.push('rotate');
            
            body.className = body.className.replace(/light-theme|purple-theme|green-theme/g, '') + ' ' + classes.join(' ');
            
            // Добавляем неоновое свечение к границам
            const container = document.querySelector('.container');
            if (container) {
                container.style.boxShadow = '0 0 50px rgba(120, 119, 198, 0.8), 0 0 100px rgba(255, 119, 198, 0.6), 0 0 150px rgba(119, 255, 198, 0.4)';
            }
            
            // Убираем эффект через заданное время
            setTimeout(() => {
                body.className = body.className.replace(/disco-mode|pulse|shake|rotate/g, '').trim();
            // Восстанавливаем тему если была
            const currentThemeClass = ['light-theme', 'purple-theme', 'green-theme', 'retro-theme', 'glass-theme'].find(cls => 
                body.className.includes(cls)
            );
            if (currentThemeClass) {
                body.className = body.className.replace(currentThemeClass, '').trim() + ' ' + currentThemeClass;
            }
                body.style.removeProperty('--disco-color-1');
                body.style.removeProperty('--disco-color-2');
                body.style.removeProperty('--disco-color-3');
                body.style.removeProperty('--disco-color-4');
                body.style.removeProperty('--disco-speed');
                
                if (container) {
                    container.style.boxShadow = '';
                }
            }, settings.duration * 1000);
        }
        
        async function startCall(username) {
            console.log('Starting call to:', username);
            
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                console.log('Микрофон разрешен');
                
                currentCall = username;
                
                await createPeerConnection();
                
                localStream.getTracks().forEach(track => {
                    peerConnection.addTrack(track, localStream);
                });
                
                const offer = await peerConnection.createOffer();
                await peerConnection.setLocalDescription(offer);
                
                socket.emit('call_request', { 
                    recipient: username,
                    offer: offer
                });
                
                showCallNotification(`📞 Звоним ${username}...`, 'outgoing');
                
            } catch (error) {
                console.error('Ошибка доступа к микрофону:', error);
                alert('Необходимо разрешить доступ к микрофону');
            }
        }
        
        function showCallNotification(message, type) {
            const callOverlay = document.createElement('div');
            callOverlay.className = 'call-overlay';
            callOverlay.innerHTML = `
                <div class="call-interface">
                    <div class="call-avatar">
                        <div class="avatar-ring"></div>
                        <div class="avatar-inner">${currentCall ? currentCall[0].toUpperCase() : '👤'}</div>
                    </div>
                    <div class="call-info">
                        <div class="caller-name">${currentCall || 'Пользователь'}</div>
                        <div class="call-status">${type === 'incoming' ? 'Входящий звонок...' : 'Исходящий звонок...'}</div>
                    </div>
                    <div class="call-controls">
                        ${type === 'incoming' ? 
                            '<button class="call-btn decline" onclick="rejectCall()">📞</button><button class="call-btn accept" onclick="acceptCall()">📞</button>' : 
                            '<button class="call-btn end" onclick="endCall()">📞</button>'}
                    </div>
                </div>
            `;
            
            callOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(20, 20, 20, 0.95));
                z-index: 15000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            document.body.appendChild(callOverlay);
            playCallSound(type);
        }
        
        function playCallSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'incoming') {
                // Звук входящего звонка
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.5);
            } else {
                // Звук исходящего звонка
                oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(500, audioContext.currentTime + 0.3);
            }
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 1);
        }
        
        async function acceptCall() {
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                await createPeerConnection();
                
                localStream.getTracks().forEach(track => {
                    peerConnection.addTrack(track, localStream);
                });
                
                if (window.incomingOffer) {
                    await peerConnection.setRemoteDescription(window.incomingOffer);
                    const answer = await peerConnection.createAnswer();
                    await peerConnection.setLocalDescription(answer);
                    
                    socket.emit('call_accepted', { answer: answer });
                } else {
                    socket.emit('call_accepted');
                }
                
                removeCallNotification();
                showActiveCall(currentCall);
                displaySystemMessage('📞 Звонок принят. Говорите!');
                
            } catch (error) {
                console.error('Ошибка доступа к микрофону:', error);
                alert('Необходимо разрешить доступ к микрофону');
                rejectCall();
            }
        }
        
        function rejectCall() {
            socket.emit('call_rejected');
            removeCallNotification();
        }
        
        let isVideoEnabled = false;
        let isScreenSharing = false;
        
        async function toggleCamera() {
            try {
                if (!isVideoEnabled) {
                    const videoStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                    
                    // Заменяем старый стрим
                    if (localStream) {
                        localStream.getTracks().forEach(track => track.stop());
                    }
                    localStream = videoStream;
                    
                    const localVideo = document.getElementById('localVideo');
                    if (localVideo) {
                        localVideo.srcObject = videoStream;
                        localVideo.style.display = 'block';
                        localVideo.play();
                    }
                    
                    // Обновляем треки в peerConnection
                    if (peerConnection) {
                        const senders = peerConnection.getSenders();
                        videoStream.getTracks().forEach(track => {
                            const sender = senders.find(s => s.track && s.track.kind === track.kind);
                            if (sender) {
                                sender.replaceTrack(track);
                            } else {
                                peerConnection.addTrack(track, videoStream);
                            }
                        });
                    }
                    
                    isVideoEnabled = true;
                    document.querySelector('.call-btn.camera').style.background = '#34c759';
                } else {
                    // Получаем только аудио
                    const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    if (localStream) {
                        localStream.getTracks().forEach(track => track.stop());
                    }
                    localStream = audioStream;
                    
                    const localVideo = document.getElementById('localVideo');
                    if (localVideo) {
                        localVideo.style.display = 'none';
                        localVideo.srcObject = null;
                    }
                    
                    // Обновляем треки в peerConnection
                    if (peerConnection) {
                        const senders = peerConnection.getSenders();
                        audioStream.getTracks().forEach(track => {
                            const sender = senders.find(s => s.track && s.track.kind === track.kind);
                            if (sender) {
                                sender.replaceTrack(track);
                            } else {
                                peerConnection.addTrack(track, audioStream);
                            }
                        });
                    }
                    
                    isVideoEnabled = false;
                    document.querySelector('.call-btn.camera').style.background = '#007aff';
                }
            } catch (error) {
                console.error('Ошибка камеры:', error);
                alert('Не удалось получить доступ к камере');
            }
        }
        
        async function toggleScreenShare() {
            try {
                if (!isScreenSharing) {
                    const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
                    
                    // Заменяем видео треки на экран
                    if (peerConnection) {
                        const videoTrack = screenStream.getVideoTracks()[0];
                        const sender = peerConnection.getSenders().find(s => s.track && s.track.kind === 'video');
                        if (sender) {
                            await sender.replaceTrack(videoTrack);
                        } else {
                            peerConnection.addTrack(videoTrack, screenStream);
                        }
                    }
                    
                    // Показываем превью экрана в локальном видео
                    const localVideo = document.getElementById('localVideo');
                    if (localVideo) {
                        localVideo.srcObject = screenStream;
                        localVideo.style.display = 'block';
                        localVideo.play();
                    }
                    
                    isScreenSharing = true;
                    document.querySelector('.call-btn.screen').style.background = '#34c759';
                    
                    // Останавливаем при закрытии экрана
                    screenStream.getVideoTracks()[0].onended = () => {
                        toggleScreenShare();
                    };
                } else {
                    // Возвращаемся к камере или убираем видео
                    if (isVideoEnabled) {
                        const videoStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                        const videoTrack = videoStream.getVideoTracks()[0];
                        
                        if (peerConnection) {
                            const sender = peerConnection.getSenders().find(s => s.track && s.track.kind === 'video');
                            if (sender) {
                                await sender.replaceTrack(videoTrack);
                            }
                        }
                        
                        const localVideo = document.getElementById('localVideo');
                        if (localVideo) {
                            localVideo.srcObject = videoStream;
                        }
                    } else {
                        // Убираем видео трек
                        if (peerConnection) {
                            const sender = peerConnection.getSenders().find(s => s.track && s.track.kind === 'video');
                            if (sender) {
                                await sender.replaceTrack(null);
                            }
                        }
                        
                        const localVideo = document.getElementById('localVideo');
                        if (localVideo) {
                            localVideo.style.display = 'none';
                            localVideo.srcObject = null;
                        }
                    }
                    
                    isScreenSharing = false;
                    document.querySelector('.call-btn.screen').style.background = '#ff9500';
                }
            } catch (error) {
                console.error('Ошибка демонстрации экрана:', error);
                alert('Не удалось получить доступ к экрану');
            }
        }
        
        function endCall() {
            if (!currentCall) return;
            
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            
            if (peerConnection) {
                peerConnection.close();
                peerConnection = null;
            }
            
            isVideoEnabled = false;
            isScreenSharing = false;
            socket.emit('call_ended');
            currentCall = null;
            removeCallNotification();
        }
        
        function removeCallNotification() {
            const callOverlay = document.querySelector('.call-overlay');
            if (callOverlay) {
                document.body.removeChild(callOverlay);
            }
        }
        
        function showActiveCall(username) {
            const callOverlay = document.createElement('div');
            callOverlay.className = 'call-overlay active-call';
            callOverlay.innerHTML = `
                <div class="call-interface">
                    <div class="video-container">
                        <video id="remoteVideo" autoplay></video>
                        <video id="localVideo" autoplay muted></video>
                        <div class="call-avatar" id="callAvatar">
                            <div class="avatar-ring"></div>
                            <div class="avatar-inner">${username ? username[0].toUpperCase() : '👤'}</div>
                        </div>
                    </div>
                    <div class="call-info">
                        <div class="caller-name">${username || 'Пользователь'}</div>
                        <div class="call-status">В эфире...</div>
                    </div>
                    <div class="call-controls">
                        <button class="call-btn camera" onclick="toggleCamera()" title="Камера">📹</button>
                        <button class="call-btn screen" onclick="toggleScreenShare()" title="Экран">🖥️</button>
                        <button class="call-btn end" onclick="endCall()">📞</button>
                    </div>
                </div>
            `;
            
            callOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(52, 199, 89, 0.2), rgba(0, 0, 0, 0.9));
                z-index: 15000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            document.body.appendChild(callOverlay);
            
            setTimeout(() => {
                const localVideo = document.getElementById('localVideo');
                const remoteVideo = document.getElementById('remoteVideo');
                
                if (localVideo) localVideo.style.display = 'none';
                if (remoteVideo) remoteVideo.style.display = 'none';
                
                isVideoEnabled = false;
                isScreenSharing = false;
            }, 100);
        }
        
            async function createPeerConnection() {
                const configuration = {
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:stun1.l.google.com:19302' }
                    ]
                };
                
                peerConnection = new RTCPeerConnection(configuration);
                
                // Обработчик входящих медиа-потоков
                peerConnection.ontrack = (event) => {
                    console.log('Получен удаленный стрим:', event.streams);
                    remoteStream = event.streams[0];
                    
                    const remoteVideo = document.getElementById('remoteVideo');
                    const callAvatar = document.getElementById('callAvatar');
                    
                    if (remoteVideo && remoteStream) {
                        remoteVideo.srcObject = remoteStream;
                        
                        // Ждем загрузки метаданных перед воспроизведением
                        remoteVideo.onloadedmetadata = () => {
                            remoteVideo.play().catch(e => {
                                console.error('Ошибка воспроизведения видео:', e);
                            });
                        };
                        
                        // Показываем видео когда есть видеотреки
                        if (remoteStream.getVideoTracks().length > 0) {
                            remoteVideo.style.display = 'block';
                            if (callAvatar) callAvatar.style.display = 'none';
                            console.log('Видео собеседника показано');
                        }
                    }
                };
                
                // Обработчик ICE кандидатов
                peerConnection.onicecandidate = (event) => {
                    if (event.candidate && currentCall) {
                        socket.emit('ice_candidate', {
                            candidate: event.candidate,
                            recipient: currentCall
                        });
                    }
                };
                
                // Обработчик изменения состояния соединения
                peerConnection.onconnectionstatechange = () => {
                    console.log('Состояние соединения:', peerConnection.connectionState);
                };
                
                // Обработчик добавления треков
                peerConnection.onnegotiationneeded = async () => {
                    console.log('Требуется переговоры');
                };
            }
        
        function toggleGiftPanel() {
            const panel = document.getElementById('giftPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        function sendGift(emoji, name) {
            if (!socket) return;
            
            const giftPrices = {
                '🌹': 10, // Роза
                '🎂': 25, // Торт
                '💎': 100, // Алмаз
                '🎆': 50, // Фейерверк
                '🎁': 30, // Подарок
                '👑': 200 // Корона
            };
            
            const price = giftPrices[emoji] || 0;
            
            // Проверяем достаточно ли звезд (админ может все)
            if (currentUser !== 'admin' && userStars < price) {
                alert(`Недостаточно звезд! Нужно: ${price} ⭐, у вас: ${userStars} ⭐`);
                return;
            }
            
            const giftData = {
                emoji: emoji,
                name: name,
                sender: currentUser,
                timestamp: Date.now(),
                price: price
            };
            
            if (activeChat.startsWith('private_')) {
                const recipient = activeChat.replace('private_', '');
                socket.emit('send_gift', {
                    ...giftData,
                    recipient: recipient,
                    isPrivate: true
                });
            } else {
                socket.emit('send_gift', giftData);
            }
            
            // Списываем звезды (кроме админа)
            if (currentUser !== 'admin') {
                userStars -= price;
                updateStarsDisplay();
            }
            
            toggleGiftPanel();
            displayGiftMessage(giftData, true);
        }
        
        function displayGiftMessage(giftData, isSent = false) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message gift-message';
            
            const time = new Date(giftData.timestamp).toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            if (isSent) {
                messageDiv.innerHTML = `
                    <div class="gift-content">
                        <div class="gift-emoji-large">${giftData.emoji}</div>
                        <div>Вы отправили ${giftData.name}</div>
                        <small>(${time})</small>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="gift-content">
                        <div class="gift-emoji-large">${giftData.emoji}</div>
                        <div><strong>${giftData.sender}</strong> подарил ${giftData.name}</div>
                        <small>(${time})</small>
                    </div>
                `;
            }
            
            messagesDiv.appendChild(messageDiv);
            
            // Анимация подарка
            createGiftAnimation(giftData.emoji);
            
            scrollToBottom();
        }
        
        function updateStarsDisplay() {
            const starsCounter = document.getElementById('starsCounter');
            if (currentUser === 'admin') {
                starsCounter.textContent = '⭐ ∞';
            } else {
                starsCounter.textContent = `⭐ ${userStars}`;
            }
        }
        
        function createGiftAnimation(emoji) {
            const animation = document.createElement('div');
            animation.className = 'gift-animation';
            animation.innerHTML = emoji;
            animation.style.cssText = `
                position: fixed;
                font-size: 64px;
                pointer-events: none;
                z-index: 9999;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%) scale(0);
                animation: giftPop 2s ease-out;
            `;
            
            document.body.appendChild(animation);
            
            setTimeout(() => {
                if (document.body.contains(animation)) {
                    document.body.removeChild(animation);
                }
            }, 2000);
        }
        
        function scrollToBottom() {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function showAuthError(message) {
            const errorDiv = document.getElementById('authError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }
        
        function logout() {
            localStorage.removeItem('token');
            token = null;
            currentUser = null;
            if (socket) socket.disconnect();
            
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('chatSection').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('authError').textContent = '';
        }
        
        // Обработчики для настроек дискотеки
        document.addEventListener('DOMContentLoaded', function() {
            const durationSlider = document.getElementById('discoDuration');
            const speedSlider = document.getElementById('discoSpeed');
            const intensitySlider = document.getElementById('discoIntensity');
            
            if (durationSlider) {
                durationSlider.addEventListener('input', function() {
                    document.getElementById('durationValue').textContent = this.value;
                });
            }
            
            if (speedSlider) {
                speedSlider.addEventListener('input', function() {
                    document.getElementById('speedValue').textContent = this.value;
                });
            }
            
            if (intensitySlider) {
                intensitySlider.addEventListener('input', function() {
                    document.getElementById('intensityValue').textContent = this.value;
                });
            }
        });
        
        let isResizing = false;
        let sidebarCollapsed = false;
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.getElementById('sidebarToggle');
            
            if (window.innerWidth <= 768) {
                // Mobile behavior
                const overlay = document.querySelector('.sidebar-overlay');
                sidebar.classList.toggle('open');
                overlay.classList.toggle('show');
            } else {
                // Desktop collapse/expand
                sidebarCollapsed = !sidebarCollapsed;
                sidebar.classList.toggle('collapsed', sidebarCollapsed);
                toggle.innerHTML = sidebarCollapsed ? '▶' : '◀';
                toggle.title = sidebarCollapsed ? 'Развернуть' : 'Свернуть';
            }
        }
        
        // Sidebar resizing functionality
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const resizer = document.getElementById('sidebarResizer');
            
            if (resizer) {
                resizer.addEventListener('mousedown', function(e) {
                    isResizing = true;
                    document.addEventListener('mousemove', handleResize);
                    document.addEventListener('mouseup', stopResize);
                    e.preventDefault();
                });
            }
            
            function handleResize(e) {
                if (!isResizing) return;
                
                const newWidth = e.clientX;
                if (newWidth >= 60 && newWidth <= 500) {
                    sidebar.style.width = newWidth + 'px';
                    
                    // Auto collapse/expand based on width
                    if (newWidth < 150 && !sidebarCollapsed) {
                        sidebarCollapsed = true;
                        sidebar.classList.add('collapsed');
                        document.getElementById('sidebarToggle').innerHTML = '▶';
                    } else if (newWidth >= 150 && sidebarCollapsed) {
                        sidebarCollapsed = false;
                        sidebar.classList.remove('collapsed');
                        document.getElementById('sidebarToggle').innerHTML = '◀';
                    }
                }
            }
            
            function stopResize() {
                isResizing = false;
                document.removeEventListener('mousemove', handleResize);
                document.removeEventListener('mouseup', stopResize);
            }
        });
        // Показываем кнопку меню на мобильных
        function checkMobile() {
            if (window.innerWidth > 768) {
                document.querySelector('.sidebar').classList.remove('open');
                document.querySelector('.sidebar-overlay').classList.remove('show');
            }
        }
        
        window.addEventListener('resize', checkMobile);
        
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (!document.getElementById('chatSection').classList.contains('hidden')) {
                    sendMessage();
                } else if (e.target.id === 'password') {
                    login();
                }
            }
        });
        // Закрытие панели обновлений по клику вне ее области
        window.addEventListener('DOMContentLoaded', function() {
            const updatesOverlay = document.getElementById('updatesOverlay');
            if (updatesOverlay) {
                updatesOverlay.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideUpdatesPanel();
                    }
                });
            }
        });
    </script>
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- Общая панель обновлений -->
    <div id="updatesOverlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); z-index: 10002; align-items: center; justify-content: center; padding: 10px;">
        <div style="width: 95%; max-width: 800px; max-height: 90vh; overflow-y: auto; position: relative; background: rgba(28, 28, 30, 0.98); backdrop-filter: blur(40px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 16px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5); animation: slideUp 0.3s ease;">
            <div style="padding: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: rgba(28, 28, 30, 0.98); z-index: 1;">
                <div style="text-align: center; font-size: 10px; color: #808080;">CLOSED ALPHA 0.2</div>
                <h3 style="margin: 0; color: #ffffff; font-size: 18px; font-weight: 600;">📋 Обновления</h3>
                <button onclick="hideUpdatesPanel()" style="background: rgba(255, 255, 255, 0.1); border: none; color: rgba(255, 255, 255, 0.7); width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; font-size: 16px;">✕</button>
            </div>
            <div style="display: flex; flex-direction: column; gap: 20px; padding: 20px;">
                <div>
                    <h4 style="color: #ffffff; margin: 0 0 15px 0; font-size: 16px; text-align: center;">🆕 Последние обновления v2.0</h4>
                    <div style="color: rgba(255, 255, 255, 0.9); font-size: 14px;">
                        <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <span style="width: 30px;">⭐</span>
                            <span>Система звезд и подарков</span>
                        </div>
                        <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <span style="width: 30px;">👑</span>
                            <span>Раздача звезд админом</span>
                        </div>
                        <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <span style="width: 30px;">🎁</span>
                            <span>Подарки с анимацией</span>
                        </div>
                        <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <span style="width: 30px;">📞</span>
                            <span>Голосовые звонки</span>
                        </div>
                        <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <span style="width: 30px;">🕺</span>
                            <span>Дискотека с настройками</span>
                        </div>
                        <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <span style="width: 30px;">🔨</span>
                            <span>Режим молота</span>
                        </div>
                        <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <span style="width: 30px;">💬</span>
                            <span>Личные сообщения</span>
                        </div>
                        <div style="display: flex; align-items: center; padding: 10px 0;">
                            <span style="width: 30px;">💾</span>
                            <span>Сохранение данных</span>
                        </div>
                    </div>
                </div>
                <div>
                    <h4 style="color: #ffffff; margin: 0 0 15px 0; font-size: 14px; text-align: center;">📅 Предыдущие версии</h4>
                    <div style="color: rgba(255, 255, 255, 0.7); font-size: 12px; line-height: 1.6;">
                        <div style="margin-bottom: 10px; padding: 8px; background: rgba(0, 122, 255, 0.1); border-radius: 8px;">
                            <div style="font-weight: 600; color: #007aff;">v1.5</div>
                            <div>Авторизация и чат</div>
                        </div>
                        <div style="margin-bottom: 10px; padding: 8px; background: rgba(255, 149, 0, 0.1); border-radius: 8px;">
                            <div style="font-weight: 600; color: #ff9500;">v1.0</div>
                            <div>Основной чат</div>
                        </div>
                        <div style="margin-bottom: 10px; padding: 8px; background: rgba(52, 199, 89, 0.1); border-radius: 8px;">
                            <div style="font-weight: 600; color: #34c759;">v0.5</div>
                            <div>Прототип</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>